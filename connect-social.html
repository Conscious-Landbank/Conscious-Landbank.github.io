<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Sign In - UNERA</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Enhanced Auth CSS -->
    <link rel="stylesheet" href="auth-enhanced.css">
    
    <style>
        .provider-icon-large {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        
        .provider-icon-large.google {
            background: linear-gradient(135deg, #4285F4, #34A853);
        }
        
        .provider-icon-large.apple {
            background: linear-gradient(135deg, #000000, #1c1c1e);
        }
        
        .provider-icon-large.microsoft {
            background: linear-gradient(135deg, #00A4EF, #FFB900);
        }
        
        .provider-icon-large svg {
            width: 40px;
            height: 40px;
            stroke: white;
            fill: none;
            stroke-width: 2.5;
        }
        
        .how-it-works {
            background: rgba(14, 165, 233, 0.08);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .how-it-works h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .how-it-works ol {
            margin: 0;
            padding-left: 1.5rem;
            list-style: decimal;
        }
        
        .how-it-works li {
            font-size: 0.938rem;
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 0.5rem;
        }
        
        .how-it-works li:last-child {
            margin-bottom: 0;
        }
        
        .permissions-info {
            background: var(--neutral-100);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .permissions-info h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }
        
        .permissions-info ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .permissions-info li {
            font-size: 0.875rem;
            color: var(--text-secondary);
            padding: 0.5rem 0;
            padding-left: 1.75rem;
            position: relative;
        }
        
        .permissions-info li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: var(--primary-green);
            font-weight: 700;
        }
        
        .connection-status {
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            text-align: center;
            display: none;
            margin: 1.5rem 0;
        }
        
        .connection-status.connecting {
            display: block;
            background: rgba(14, 165, 233, 0.1);
            color: var(--primary-blue);
        }
        
        .connection-status.success {
            display: block;
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary-green);
        }
        
        .connection-status.error {
            display: block;
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        
        .status-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        
        .privacy-notice {
            background: rgba(16, 185, 129, 0.05);
            border-left: 4px solid var(--primary-green);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .privacy-notice h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .privacy-notice p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 0;
        }
    </style>
</head>
<body>
    <!-- Skip Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <svg class="logo-icon" viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg">
                <circle cx="70" cy="70" r="60" fill="#14B8A6"/>
                <circle cx="70" cy="70" r="45" fill="#2DD4BF"/>
                <circle cx="70" cy="70" r="30" fill="#5EEAD4"/>
                <circle cx="70" cy="70" r="15" fill="#FFFFFF"/>
            </svg>
            <span class="logo-text">UNERA</span>
        </div>
        <a href="signup_2.html" class="back-btn">
            <svg viewBox="0 0 24 24" fill="none">
                <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back
        </a>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="auth-container">
        <div class="auth-card">
            <!-- Provider Icon -->
            <div class="provider-icon-large" id="providerIcon">
                <svg viewBox="0 0 24 24" id="providerSvg">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>

            <!-- Auth Header -->
            <div class="auth-header" style="text-align: center;">
                <h1 class="auth-title" id="providerTitle">Continue with Google</h1>
                <p class="auth-subtitle" id="providerSubtitle">Sign in using your Google account</p>
            </div>

            <!-- Connection Status -->
            <div class="connection-status" id="connectionStatus"></div>

            <!-- How It Works -->
            <div class="how-it-works">
                <h4>How it works:</h4>
                <ol>
                    <li>Click "Continue" below</li>
                    <li>You'll be redirected to <span id="providerName">Google</span></li>
                    <li>Sign in with your existing account</li>
                    <li>Grant UNERA access to your profile</li>
                    <li>You'll be securely signed in</li>
                </ol>
            </div>

            <!-- Permissions Info -->
            <div class="permissions-info">
                <h4>What we'll access:</h4>
                <ul>
                    <li>Your name and profile picture</li>
                    <li>Your email address (for account recovery)</li>
                    <li>Basic profile information</li>
                </ul>
            </div>

            <!-- Privacy Notice -->
            <div class="privacy-notice">
                <h4>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                        <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Your Privacy Matters
                </h4>
                <p>
                    We'll never post anything without your permission or access your private data. 
                    You can disconnect your <span id="providerName2">Google</span> account anytime from your settings.
                </p>
            </div>

            <!-- Connect Button -->
            <button class="submit-btn sticky-cta" id="connectBtn" onclick="initiateConnection()">
                Continue with <span id="providerButton">Google</span>
            </button>
        </div>
    </main>

    <!-- Auth Flow Manager -->
    <script src="auth-flow.js"></script>

    <!-- JavaScript -->
    <script>
        console.log('üîê Social Connection Page Loaded');

        // Get provider and flow type from URL
        const urlParams = new URLSearchParams(window.location.search);
        const provider = urlParams.get('provider') || 'google';
        const flowType = urlParams.get('flow') || 'signup'; // Default to signup
        
        console.log(`üîê Flow type: ${flowType}`);
        
        // Provider configurations
        const providers = {
            google: {
                name: 'Google',
                title: 'Continue with Google',
                subtitle: 'Sign in using your Google account',
                icon: '<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke-linecap="round" stroke-linejoin="round"/>',
                color: 'linear-gradient(135deg, #4285F4, #34A853)'
            },
            apple: {
                name: 'Apple',
                title: 'Continue with Apple',
                subtitle: 'Sign in using your Apple ID',
                icon: '<path d="M12 2v20M2 12h20" stroke-linecap="round"/>',
                color: 'linear-gradient(135deg, #000000, #1c1c1e)'
            },
            microsoft: {
                name: 'Microsoft',
                title: 'Continue with Microsoft',
                subtitle: 'Sign in using your Microsoft account',
                icon: '<rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>',
                color: 'linear-gradient(135deg, #00A4EF, #FFB900)'
            }
        };

        // Set provider details
        const config = providers[provider] || providers.google;
        document.getElementById('providerTitle').textContent = config.title;
        document.getElementById('providerSubtitle').textContent = config.subtitle;
        document.getElementById('providerSvg').innerHTML = config.icon;
        document.getElementById('providerIcon').style.background = config.color;
        document.getElementById('providerIcon').className = `provider-icon-large ${provider}`;
        document.getElementById('providerName').textContent = config.name;
        document.getElementById('providerName2').textContent = config.name;
        document.getElementById('providerButton').textContent = config.name;
        
        console.log(`üîê Provider: ${config.name}`);

        // Initiate connection
        async function initiateConnection() {
            const btn = document.getElementById('connectBtn');
            
            // Show connecting state
            btn.classList.add('loading');
            btn.disabled = true;
            showStatus('connecting', 'üîÑ', 'Opening ' + config.name + '...', 'Please wait while we redirect you');
            
            try {
                console.log(`üîê Initiating ${config.name} OAuth...`);
                
                // Simulate OAuth redirect (in production, redirect to OAuth provider)
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Simulate OAuth callback (in production, handle OAuth callback)
                showStatus('connecting', '‚úÖ', 'Authorizing...', 'Please approve the connection in ' + config.name);
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Simulate successful OAuth
                const mockEmail = `user@${provider}.com`;
                const mockName = `${config.name} User`;
                
                console.log('‚úÖ OAuth successful:', mockEmail);
                
                // Store connection info
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('emailVerified', 'true');
                localStorage.setItem('userEmail', mockEmail);
                localStorage.setItem('userName', mockName);
                localStorage.setItem('userInitials', mockName.split(' ').map(n => n[0]).join(''));
                localStorage.setItem('signupMethod', provider);
                localStorage.setItem('oauthProvider', provider);
                
                // Show success
                showStatus('success', '‚úÖ', 'Connected Successfully!', `Signed in as ${mockEmail}`);
                
                btn.classList.remove('loading');
                btn.classList.add('success');
                btn.textContent = 'Connected!';
                
                // Haptic feedback
                if (window.navigator.vibrate) {
                    window.navigator.vibrate([10, 50, 10]);
                }
                
                // Redirect based on flow type
                setTimeout(() => {
                    if (flowType === 'login') {
                        // Existing user - check if 2FA is enabled
                        const has2FA = localStorage.getItem('2faEnabled') === 'true';
                        if (has2FA) {
                            console.log('üîê Redirecting to 2FA verification...');
                            window.location.href = `verify-2fa.html?from=${provider}`;
                        } else {
                            console.log('üìä Redirecting to dashboard...');
                            window.location.href = 'dashboard-enhanced.html?welcome=back';
                        }
                    } else {
                        // New user - go to 2FA setup
                        console.log('üîê Redirecting to 2FA setup...');
                        window.location.href = `setup-2fa.html?from=${provider}`;
                    }
                }, 1500);
                
            } catch (error) {
                console.error('‚ùå OAuth error:', error);
                
                btn.classList.remove('loading');
                btn.disabled = false;
                
                showStatus('error', '‚ùå', 'Connection Failed', error.message || 'Please try again');
            }
        }

        // Show status message
        function showStatus(type, icon, title, message) {
            const status = document.getElementById('connectionStatus');
            status.className = `connection-status ${type}`;
            status.innerHTML = `
                <div class="status-icon">${icon}</div>
                <div style="font-weight: 600; margin-bottom: 0.5rem;">${title}</div>
                <div style="font-size: 0.875rem; opacity: 0.9;">${message}</div>
            `;
        }
    </script>
</body>
</html>
