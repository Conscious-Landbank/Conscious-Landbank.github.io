<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet & Transactions - UNERA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* UNERA Brand Colors */
            --primary-green: #10B981;
            --primary-blue: #0EA5E9;
            --accent-pink: #EC4899;
            --neutral-900: #1F2937;
            --neutral-800: #374151;
            --neutral-700: #4B5563;
            --neutral-600: #6B7280;
            --neutral-500: #9CA3AF;
            --neutral-400: #D1D5DB;
            --neutral-300: #E5E7EB;
            --neutral-200: #F3F4F6;
            --neutral-100: #F9FAFB;
            --neutral-50: #FFFFFF;
            --success: #059669;
            --warning: #F59E0B;
            --error: #EF4444;
            --gradient-primary: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%);
            --gradient-sky: linear-gradient(135deg, #0EA5E9 0%, #3B82F6 100%);
            --gradient-warm: linear-gradient(135deg, #F59E0B 0%, #EC4899 100%);
            --font-display: 'Space Grotesk', sans-serif;
            --font-body: 'Inter', sans-serif;
            
            /* Accessibility - AAA Contrast */
            --text-primary: #0F172A;
            --text-secondary: #475569;
            --border-subtle: #E2E8F0;
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }

        /* Skip to Main Content Link (Accessibility) */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary-green);
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 10000;
            border-radius: 0 0 8px 0;
            font-weight: 600;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Navigation */
        .nav {
            background: #FFFFFF;
            padding: 0 2.75rem;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-subtle);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 2.75rem;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .nav-brand:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
            border-radius: 4px;
        }

        .nav-logo-icon {
            width: 28px;
            height: 28px;
        }

        .logo {
            font-family: var(--font-display);
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .nav-links {
            display: flex;
            gap: 1.375rem;
            list-style: none;
        }

        .nav-link {
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            transition: color 0.2s;
            padding: 0.5rem;
            border-radius: 4px;
        }

        .nav-link:hover {
            color: var(--primary-green);
        }

        .nav-link:focus {
            outline: 2px solid var(--primary-green);
            outline-offset: 2px;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 2.75rem;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 3rem;
        }

        .welcome-text {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .page-title {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.75rem;
            line-height: 1.1;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1.25rem;
            line-height: 1.6;
        }

        /* Alert Banner */
        .alert-banner {
            background: var(--gradient-warm);
            border-radius: 1.25rem;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            box-shadow: 0 4px 16px rgba(236, 72, 153, 0.2);
        }

        .alert-content {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            flex: 1;
        }

        .alert-icon {
            width: 28px;
            height: 28px;
            stroke: white;
            flex-shrink: 0;
        }

        .alert-text {
            flex: 1;
        }

        .alert-title {
            color: white;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.25rem;
            text-align: left;
        }

        .alert-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .alert-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .alert-cta {
            background: white;
            color: var(--accent-pink);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 980px;
            font-weight: 600;
            font-size: 0.938rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .alert-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .alert-dismiss {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .alert-dismiss:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Impact Summary Section */
        .impact-summary-wallet {
            background: white;
            border: 2px solid var(--border-subtle);
            border-radius: 1.25rem;
            padding: 1.75rem 2rem;
            margin-bottom: 2.5rem;
        }

        .impact-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title-small {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .view-link {
            color: var(--primary-green);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.938rem;
            transition: color 0.2s;
        }

        .view-link:hover {
            color: var(--primary-blue);
        }

        .impact-stats-inline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 2rem;
        }

        .impact-stat-mini {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .stat-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .stat-content {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.813rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Wallet Section */
        .wallet-section {
            margin-bottom: 4rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Enhanced Privacy Toggle with Icon State */
        .privacy-toggle {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: var(--neutral-50);
            border: 2px solid var(--border-subtle);
            border-radius: 980px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s;
            font-family: var(--font-body);
        }

        .privacy-toggle:hover {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.05);
            transform: translateY(-1px);
        }

        .privacy-toggle:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .privacy-toggle-icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            transition: all 0.2s;
        }

        /* Enhanced Total Balance Card - More Prominent */
        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .balance-card.total {
            grid-column: 1 / -1;
        }

        .balance-card {
            background: var(--neutral-50);
            border: 2px solid var(--border-subtle);
            border-radius: 1.25rem;
            padding: 2rem;
            transition: all 0.3s;
            position: relative;
            overflow: visible;
            min-height: 200px; /* Allow cards to grow when content wraps */
            display: flex;
            flex-direction: column;
        }

        .balance-card:hover {
            border-color: var(--primary-green);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.12);
            transform: translateY(-4px);
        }

        /* Total Balance - Hero Card */
        .balance-card.total {
            background: var(--gradient-primary);
            border: none;
            color: var(--neutral-50);
            padding: 3rem 2.5rem;
            position: relative;
            overflow: visible;
        }

        .balance-card.total::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 8s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-20px, -20px); }
        }

        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
            flex-wrap: wrap; /* Allow wrapping when content is too wide */
            min-height: 48px; /* Ensure consistent minimum height */
        }

        .currency-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 0 1 auto; /* Don't grow, can shrink, auto width */
            max-width: 65%; /* Prevent from taking too much space */
        }

        .currency-info > div {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Currency Icons with Flags */
        .currency-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            backdrop-filter: blur(10px);
        }

        .balance-card.total .currency-icon {
            background: rgba(255, 255, 255, 0.25);
            color: var(--neutral-50);
        }

        .balance-card:not(.total) .currency-icon {
            background: var(--neutral-100);
            color: var(--text-primary);
        }

        .currency-name {
            font-size: 0.938rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .balance-card:not(.total) .currency-name {
            color: var(--text-secondary);
        }

        /* Prominent Total Balance Amount */
        .balance-amount {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 800;
            color: var(--neutral-50);
            margin-bottom: 0.5rem;
            line-height: 1;
            position: relative;
            z-index: 1;
        }

        .balance-card:not(.total) .balance-amount {
            font-size: 1.75rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        .balance-amount.hidden {
            filter: blur(12px);
            user-select: none;
            pointer-events: none;
        }

        .balance-fiat {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.85);
            position: relative;
            z-index: 1;
        }

        .balance-card:not(.total) .balance-fiat {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Enhanced Balance Change - Color-Blind Friendly */
        .balance-change {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.813rem;
            font-weight: 700;
            cursor: help;
            position: relative;
            flex-shrink: 0;
            white-space: nowrap;
            flex: 0 0 auto; /* Don't grow or shrink */
            margin-top: auto; /* Push to bottom when wrapped */
        }

        .balance-change.positive {
            background: rgba(5, 150, 105, 0.15);
            color: #047857;
            border: 1px solid rgba(5, 150, 105, 0.3);
        }

        .balance-change.negative {
            background: rgba(239, 68, 68, 0.15);
            color: #DC2626;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Tooltip for Balance Change */
        .balance-change::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 0.75rem;
            background: var(--neutral-900);
            color: white;
            font-size: 0.75rem;
            border-radius: 0.5rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            pointer-events: none;
            z-index: 1000;
        }

        .balance-change:hover::after,
        .balance-change:focus::after {
            opacity: 1;
            visibility: visible;
        }

        /* Info Icon for HUMA */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: rgba(14, 165, 233, 0.15);
            color: var(--primary-blue);
            font-size: 0.75rem;
            font-weight: 700;
            cursor: help;
            margin-left: 0.375rem;
            position: relative;
        }

        .info-icon::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1rem;
            background: var(--neutral-900);
            color: white;
            font-size: 0.813rem;
            font-weight: 400;
            border-radius: 0.75rem;
            white-space: nowrap;
            max-width: 280px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            pointer-events: none;
            z-index: 1000;
            line-height: 1.5;
        }

        .info-icon:hover::after,
        .info-icon:focus::after {
            opacity: 1;
            visibility: visible;
        }

        /* ========================================
           BOSS REQUIREMENTS: ENHANCED BALANCE CARDS
           ======================================== */

        /* Balance Value Section - Prominent Display */
        .balance-value-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        .balance-card:not(.total) .balance-value-section {
            border-top-color: var(--border-subtle);
        }

        .balance-amount-group {
            margin-bottom: 1.25rem;
        }

        .balance-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-secondary);
            margin-bottom: 0.625rem;
        }

        .balance-card.total .balance-label {
            color: rgba(255, 255, 255, 0.8);
        }

        .balance-amount-group .balance-amount {
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1.1;
            display: inline;
            margin-right: 0.5rem;
        }

        .balance-unit {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .balance-card.total .balance-unit {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Fiat Value Box - BOSS REQUIREMENT: Prominent Total Value */
        .balance-fiat-value {
            padding: 1.125rem 1.25rem;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.12), rgba(59, 130, 246, 0.08));
            border-radius: 0.875rem;
            border: 2px solid rgba(16, 185, 129, 0.25);
            position: relative;
            overflow: hidden;
        }

        .balance-fiat-value::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .balance-fiat-value:hover::before {
            opacity: 1;
        }

        .balance-card.total .balance-fiat-value {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .fiat-label {
            display: block;
            font-size: 0.688rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--primary-green);
            margin-bottom: 0.5rem;
        }

        .balance-card.total .fiat-label {
            color: rgba(255, 255, 255, 0.9);
        }

        .fiat-amount {
            font-size: 1.625rem;
            font-weight: 700;
            font-family: var(--font-display);
            color: var(--primary-green);
            line-height: 1.2;
        }

        .balance-card.total .fiat-amount {
            color: white;
        }

        .fiat-detail {
            display: block;
            font-size: 0.813rem;
            color: var(--text-secondary);
            margin-top: 0.375rem;
            font-style: italic;
        }

        .balance-fiat-value.governance {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.12), rgba(217, 119, 6, 0.08));
            border-color: rgba(245, 158, 11, 0.3);
        }

        .balance-fiat-value.governance .fiat-label {
            color: #D97706;
        }

        .balance-fiat-value.governance .fiat-amount {
            color: #D97706;
        }

        /* BOSS REQUIREMENT: Per-Asset Quick Actions */
        .asset-quick-actions {
            display: flex;
            gap: 0.625rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border-subtle);
        }

        .balance-card.total .asset-quick-actions {
            border-top-color: rgba(255, 255, 255, 0.2);
        }

        .asset-action-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.875rem;
            background: var(--neutral-50);
            border: 2px solid var(--border-subtle);
            border-radius: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .balance-card.total .asset-action-btn {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            color: rgba(255, 255, 255, 0.9);
        }

        .asset-action-btn:hover {
            background: white;
            border-color: var(--primary-green);
            color: var(--primary-green);
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.25);
        }

        .balance-card.total .asset-action-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: white;
            color: white;
        }

        .asset-action-btn:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .asset-action-btn:active {
            transform: translateY(-1px);
        }

        /* ========================================
           BOSS REQUIREMENTS: ASSET SUMMARY PANEL
           ======================================== */

        .asset-summary-panel {
            background: white;
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2.5rem;
            border: 2px solid var(--border-subtle);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .summary-stat-card {
            padding: 1.75rem;
            background: linear-gradient(135deg, var(--neutral-50), var(--neutral-100));
            border-radius: 1.125rem;
            border: 2px solid var(--border-subtle);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .summary-stat-card:hover {
            border-color: var(--primary-green);
            background: white;
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15);
        }

        .stat-label {
            display: block;
            font-size: 0.813rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-secondary);
            margin-bottom: 0.875rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: var(--font-display);
            color: var(--text-primary);
            line-height: 1.1;
            margin-bottom: 0.625rem;
        }

        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.938rem;
            font-weight: 700;
            padding: 0.375rem 0.75rem;
            border-radius: 980px;
            background: rgba(16, 185, 129, 0.12);
        }

        .stat-change.positive {
            color: var(--success);
            background: rgba(16, 185, 129, 0.12);
        }

        .stat-change.negative {
            color: var(--error);
            background: rgba(220, 38, 38, 0.12);
        }

        .stat-detail {
            display: block;
            font-size: 0.938rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* ========================================
           BOSS REQUIREMENTS: DISTRIBUTION CHART
           ======================================== */

        .asset-distribution {
            border-top: 2px solid var(--border-subtle);
            padding-top: 2.5rem;
        }

        .asset-distribution h3 {
            font-size: 1.188rem;
            font-weight: 700;
            font-family: var(--font-display);
            margin: 0 0 2rem 0;
            color: var(--text-primary);
        }

        .distribution-bars {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .distribution-bar-item {
            position: relative;
        }

        .distribution-bar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .distribution-label {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .distribution-icon {
            font-size: 1.5rem;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--neutral-100);
            border-radius: 0.5rem;
        }

        .distribution-name {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .distribution-value {
            font-size: 0.938rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .distribution-bar {
            height: 48px;
            background: var(--neutral-100);
            border-radius: 0.75rem;
            overflow: hidden;
            position: relative;
        }

        .distribution-bar-fill {
            height: 100%;
            border-radius: 0.75rem;
            position: relative;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            padding-left: 1rem;
            font-weight: 700;
            color: white;
            font-size: 0.875rem;
        }

        .distribution-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .distribution-bar-fill.hcad {
            background: linear-gradient(90deg, #10B981, #059669);
        }

        .distribution-bar-fill.husd {
            background: linear-gradient(90deg, #3B82F6, #2563EB);
        }

        .distribution-bar-fill.heur {
            background: linear-gradient(90deg, #8B5CF6, #7C3AED);
        }

        .distribution-bar-fill.huma {
            background: linear-gradient(90deg, #F59E0B, #D97706);
        }

        .distribution-bar-item:hover .distribution-bar-fill {
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        /* Mobile Responsive for New Components */
        @media (max-width: 768px) {
            .asset-summary-panel {
                padding: 1.5rem;
                margin-bottom: 2rem;
            }

            .summary-stats {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .summary-stat-card {
                padding: 1.5rem;
            }

            .stat-value {
                font-size: 2rem;
            }

            .asset-distribution {
                padding-top: 2rem;
            }

            .distribution-bar {
                height: 40px;
            }

            .distribution-bar-header {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .balance-value-section {
                margin-top: 1.25rem;
                padding-top: 1.25rem;
            }

            .balance-amount-group .balance-amount {
                font-size: 1.875rem;
            }

            .fiat-amount {
                font-size: 1.375rem;
            }

            .asset-quick-actions {
                flex-wrap: wrap;
            }

            .asset-action-btn {
                min-width: calc(33.333% - 0.5rem);
                padding: 0.75rem 0.5rem;
            }
        }

        /* Quick Actions - Enhanced with Primary CTA */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 4rem;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1.5rem 1rem;
            background: var(--neutral-50);
            border: 2px solid var(--border-subtle);
            border-radius: 1rem;
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .action-btn:hover {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.05);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15);
        }

        .action-btn:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .action-btn:active {
            transform: translateY(-2px) scale(0.98);
        }

        /* Primary CTA - Donate Button */
        .action-btn.primary {
            background: var(--gradient-primary);
            border: none;
            color: var(--neutral-50);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
        }

        .action-btn.primary:hover {
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.35);
            transform: translateY(-6px) scale(1.02);
        }

        .action-btn.primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .action-btn.primary:hover::before {
            opacity: 1;
        }

        /* Recommended Badge */
        .recommended-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.625rem;
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            border-radius: 980px;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            z-index: 10;
            pointer-events: none;
        }

        .action-btn-icon {
            width: 28px;
            height: 28px;
            stroke: currentColor;
        }

        /* Loading State for Buttons */
        .action-btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .action-btn.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid currentColor;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Transaction History Section */
        .history-section {
            margin-top: 4rem;
        }

        .history-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .search-bar {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1.25rem 0.875rem 3.5rem;
            border: 2px solid var(--border-subtle);
            border-radius: 980px;
            font-size: 1rem;
            font-family: var(--font-body);
            transition: all 0.2s;
            color: var(--text-primary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .search-input::placeholder {
            color: var(--neutral-500);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--neutral-500);
            pointer-events: none;
        }

        .search-clear-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--neutral-500);
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .search-clear-btn:hover {
            background: var(--neutral-100);
            color: var(--text-primary);
        }

        .search-clear-btn:focus {
            outline: 2px solid var(--primary-green);
            outline-offset: 2px;
        }

        .filter-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.5rem;
            background: var(--neutral-50);
            border: 2px solid var(--border-subtle);
            border-radius: 980px;
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .filter-btn:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .filter-btn.active {
            background: var(--primary-green);
            border-color: var(--primary-green);
            color: white;
        }

        /* Active Filters Chips */
        .active-filters {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--primary-green);
            border-radius: 980px;
            font-size: 0.875rem;
            color: var(--primary-green);
            font-weight: 600;
        }

        .filter-chip button {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .filter-chip button:hover {
            background: rgba(16, 185, 129, 0.2);
        }

        .filter-chip-clear-all {
            background: none;
            border: 2px solid var(--neutral-300);
            color: var(--text-secondary);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 980px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .filter-chip-clear-all:hover {
            border-color: var(--primary-green);
            color: var(--primary-green);
        }

        /* Filter Modal */
        .filter-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .filter-modal.active {
            display: flex;
        }

        .filter-modal-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease-out;
        }

        .filter-modal-content {
            position: relative;
            background: white;
            border-radius: 1.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .filter-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 2rem;
            border-bottom: 2px solid var(--border-subtle);
        }

        .filter-modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .modal-close-btn {
            background: none;
            border: none;
            color: var(--neutral-500);
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .modal-close-btn:hover {
            background: var(--neutral-100);
            color: var(--text-primary);
        }

        .modal-close-btn:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .filter-modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
        }

        .filter-section {
            margin-bottom: 2rem;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-section h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 1rem 0;
        }

        .date-range-presets {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .date-preset-btn {
            padding: 0.5rem 1rem;
            background: var(--neutral-100);
            border: 2px solid var(--border-subtle);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .date-preset-btn:hover {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.05);
            color: var(--primary-green);
        }

        .date-preset-btn.active {
            background: var(--primary-green);
            border-color: var(--primary-green);
            color: white;
        }

        .date-range-custom {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .date-range-custom label {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .date-range-custom input[type="date"] {
            padding: 0.75rem;
            border: 2px solid var(--border-subtle);
            border-radius: 0.5rem;
            font-size: 1rem;
            font-family: var(--font-body);
            transition: all 0.2s;
        }

        .date-range-custom input[type="date"]:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .radio-label,
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            background: var(--neutral-50);
            border: 2px solid var(--border-subtle);
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.938rem;
            min-height: 48px; /* WCAG touch target */
        }

        .radio-label:hover,
        .checkbox-label:hover {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.02);
        }

        .radio-label input[type="radio"],
        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary-green);
        }

        .radio-label input[type="radio"]:checked + span,
        .checkbox-label input[type="checkbox"]:checked + span {
            font-weight: 700;
            color: var(--primary-green);
        }

        .radio-label input[type="radio"]:focus,
        .checkbox-label input[type="checkbox"]:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .filter-section select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-subtle);
            border-radius: 0.75rem;
            font-size: 1rem;
            font-family: var(--font-body);
            background: var(--neutral-50);
            cursor: pointer;
            transition: all 0.2s;
            min-height: 48px;
        }

        .filter-section select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .filter-modal-footer {
            display: flex;
            gap: 1rem;
            padding: 1.5rem 2rem;
            border-top: 2px solid var(--border-subtle);
        }

        .filter-modal-footer button {
            flex: 1;
            padding: 0.875rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 48px;
        }

        /* Mobile: Bottom Sheet */
        @media (max-width: 768px) {
            .filter-modal.active {
                align-items: flex-end;
            }
            
            .filter-modal-content {
                width: 100%;
                max-width: none;
                border-radius: 1.5rem 1.5rem 0 0;
                max-height: 90vh;
                animation: slideUpMobile 0.3s ease-out;
            }

            @keyframes slideUpMobile {
                from {
                    transform: translateY(100%);
                }
                to {
                    transform: translateY(0);
                }
            }

            .date-range-custom {
                grid-template-columns: 1fr;
            }

            .date-range-presets {
                flex-direction: column;
            }

            .date-preset-btn {
                width: 100%;
            }
        }

        /* Transaction List - Enhanced with Avatars */
        .transaction-list {
            background: var(--neutral-50);
            border-radius: 1.25rem;
            border: 2px solid var(--border-subtle);
            overflow: hidden;
        }

        .date-group {
            border-bottom: 1px solid var(--border-subtle);
        }

        .date-group:last-child {
            border-bottom: none;
        }

        .date-header {
            padding: 1rem 1.5rem; /* Balanced padding - no extra bottom padding */
            background: var(--neutral-100);
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 44px;
            z-index: 10;
            margin-bottom: 1.5rem; /* Spacing created via margin instead */
        }

        .transaction-item {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-item:hover {
            background: rgba(16, 185, 129, 0.02);
        }

        .transaction-item:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: -3px;
        }

        /* Transaction Icon with Avatar/Logo */
        .transaction-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.25rem;
            font-weight: 700;
            position: relative;
        }

        .transaction-icon.in {
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.15) 0%, rgba(16, 185, 129, 0.15) 100%);
            color: var(--success);
            border: 2px solid rgba(5, 150, 105, 0.3);
        }

        .transaction-icon.out {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.15) 0%, rgba(239, 68, 68, 0.15) 100%);
            color: var(--error);
            border: 2px solid rgba(239, 68, 68, 0.3);
        }

        .transaction-icon.pending {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(251, 191, 36, 0.15) 100%);
            color: var(--warning);
            border: 2px solid rgba(245, 158, 11, 0.3);
        }

        .transaction-icon.donation {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.15) 0%, rgba(16, 185, 129, 0.15) 100%);
            color: var(--accent-pink);
            border: 2px solid rgba(236, 72, 153, 0.3);
        }

        .transaction-icon.yield {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.15) 0%, rgba(16, 185, 129, 0.15) 100%);
            color: var(--primary-blue);
            border: 2px solid rgba(14, 165, 233, 0.3);
        }

        .transaction-icon.convert {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(14, 165, 233, 0.15) 100%);
            color: #8B5CF6;
            border: 2px solid rgba(139, 92, 246, 0.3);
        }

        .transaction-icon.reward {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(236, 72, 153, 0.15) 100%);
            color: var(--warning);
            border: 2px solid rgba(245, 158, 11, 0.3);
        }

        .transaction-details {
            flex: 1;
            min-width: 0;
        }

        .transaction-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.375rem;
            font-size: 1rem;
        }

        .transaction-meta {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .transaction-status {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.625rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .transaction-status.completed {
            background: rgba(5, 150, 105, 0.15);
            color: #047857;
        }

        .transaction-status.pending {
            background: rgba(245, 158, 11, 0.15);
            color: #D97706;
        }

        .transaction-amount {
            text-align: right;
            flex-shrink: 0;
        }

        .amount-primary {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .amount-primary.positive {
            color: var(--success);
        }

        .amount-primary.negative {
            color: var(--error);
        }

        .amount-secondary {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Load More Container */
        .load-more-container {
            text-align: center;
            padding: 2rem 0 3rem 0;
        }

        .transaction-count {
            font-size: 0.938rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .transaction-count span {
            font-weight: 700;
            color: var(--text-primary);
        }

        .load-more-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            background: white;
            border: 2px solid var(--border-subtle);
            border-radius: 980px;
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .load-more-btn:hover {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }

        .load-more-btn:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .load-more-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .load-more-btn svg {
            transition: transform 0.2s;
        }

        .load-more-btn:hover:not(:disabled) svg {
            transform: translateY(2px);
        }

        /* Loading Indicator */
        .loading-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 2rem;
            color: var(--text-secondary);
            font-size: 0.938rem;
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--neutral-200);
            border-top-color: var(--primary-green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Search Highlight */
        .search-highlight {
            background: rgba(255, 235, 59, 0.4);
            color: inherit;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-weight: 600;
            animation: highlightPulse 0.3s ease-out;
        }

        @keyframes highlightPulse {
            0% {
                background: rgba(255, 235, 59, 0.8);
            }
            100% {
                background: rgba(255, 235, 59, 0.4);
            }
        }

        /* Filter Presets */
        .filter-presets {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .filter-presets-empty {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-style: italic;
            text-align: center;
            padding: 1rem;
        }

        .preset-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: var(--neutral-50);
            border: 2px solid var(--border-subtle);
            border-radius: 0.75rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .preset-item:hover {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .preset-item-name {
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .preset-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .preset-delete-btn {
            background: none;
            border: none;
            color: var(--neutral-500);
            cursor: pointer;
            padding: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }

        .preset-delete-btn:hover {
            color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
        }

        .btn-save-preset {
            width: 100%;
            padding: 0.75rem 1rem;
            background: white;
            border: 2px dashed var(--primary-green);
            border-radius: 0.75rem;
            color: var(--primary-green);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-save-preset:hover {
            background: rgba(16, 185, 129, 0.05);
        }

        /* Preset Dialog */
        .preset-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1100;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .preset-dialog.active {
            display: flex;
        }

        .preset-dialog-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .preset-dialog-content {
            position: relative;
            background: white;
            border-radius: 1.25rem;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        .preset-dialog-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
        }

        .preset-dialog-content p {
            font-size: 0.938rem;
            color: var(--text-secondary);
            margin: 0 0 1.5rem 0;
        }

        .preset-dialog-content input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-subtle);
            border-radius: 0.75rem;
            font-size: 1rem;
            font-family: var(--font-body);
            margin-bottom: 1.5rem;
        }

        .preset-dialog-content input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .preset-dialog-actions {
            display: flex;
            gap: 1rem;
        }

        .preset-dialog-actions button {
            flex: 1;
            padding: 0.875rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* Export Container & Button */
        .export-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1.5rem;
        }

        .export-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 980px;
            font-family: var(--font-body);
            font-size: 0.938rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .export-btn:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        /* Export Dialog */
        .export-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1100;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .export-dialog.active {
            display: flex;
        }

        .export-dialog-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .export-dialog-content {
            position: relative;
            background: white;
            border-radius: 1.25rem;
            padding: 2rem;
            width: 90%;
            max-width: 480px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        .export-dialog-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
        }

        .export-dialog-content > p {
            font-size: 0.938rem;
            color: var(--text-secondary);
            margin: 0 0 1.5rem 0;
        }

        .export-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .export-option-btn {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: var(--neutral-50);
            border: 2px solid var(--border-subtle);
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .export-option-btn:hover {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.05);
            transform: translateX(4px);
        }

        .export-option-btn:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .export-option-btn svg {
            color: var(--primary-green);
            flex-shrink: 0;
        }

        .export-option-btn div {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .export-option-btn strong {
            color: var(--text-primary);
            font-size: 1rem;
        }

        .export-option-btn span {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .export-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(16, 185, 129, 0.05);
            border: 2px solid rgba(16, 185, 129, 0.2);
            border-radius: 0.75rem;
            font-size: 0.938rem;
            color: var(--text-secondary);
        }

        .export-info svg {
            color: var(--primary-green);
            flex-shrink: 0;
        }

        .export-info strong {
            color: var(--text-primary);
            font-weight: 700;
        }

        .export-dialog-footer {
            display: flex;
            gap: 1rem;
            padding: 1.5rem 0 0 0;
            margin-top: 1.5rem;
            border-top: 2px solid var(--border-subtle);
        }

        .export-dialog-footer button {
            flex: 1;
            padding: 0.875rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 0.75rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 5rem 2rem;
        }

        .empty-icon {
            width: 96px;
            height: 96px;
            margin: 0 auto 2rem;
            opacity: 0.2;
        }

        .empty-title {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .empty-text {
            color: var(--text-secondary);
            max-width: 480px;
            margin: 0 auto 2rem;
            font-size: 1.063rem;
            line-height: 1.6;
        }

        .empty-action {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            background: var(--gradient-primary);
            border: none;
            border-radius: 980px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-body);
        }

        .empty-action:hover {
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
            transform: translateY(-2px);
        }

        /* Modal - Enhanced with ARIA */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.2s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--neutral-50);
            border-radius: 1.5rem;
            max-width: 640px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            position: relative;
        }

        @keyframes slideUp {
            from { transform: translateY(40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 2px solid var(--border-subtle);
            position: relative;
        }

        .modal-title {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            width: 40px;
            height: 40px;
            border: none;
            background: var(--neutral-200);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--neutral-300);
            transform: rotate(90deg);
        }

        .modal-close:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }

        .modal-body {
            padding: 2rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 1.25rem 0;
            border-bottom: 1px solid var(--border-subtle);
            gap: 2rem;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 700;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .detail-value {
            text-align: right;
            color: var(--text-primary);
            word-break: break-word;
        }

        /* Responsive Grid */
        @media (max-width: 1200px) {
            .balance-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1.5rem 1rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .alert-banner {
                flex-direction: column;
                gap: 1.5rem;
                padding: 1.25rem 1.5rem;
            }

            .alert-actions {
                width: 100%;
                justify-content: space-between;
            }

            .alert-cta {
                flex: 1;
            }

            .impact-stats-inline {
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }

            .stat-icon {
                font-size: 1.75rem;
            }

            .stat-value {
                font-size: 1.25rem;
            }

            .balance-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                grid-template-columns: 1fr 1fr;
            }

            .balance-amount {
                font-size: 2rem !important;
            }

            .history-controls {
                flex-direction: column;
            }

            .transaction-item {
                flex-wrap: wrap;
            }

            .transaction-amount {
                width: 100%;
                text-align: left;
                margin-top: 0.75rem;
            }

            .balance-header {
                gap: 0.5rem;
            }

            .balance-change {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }
        }

        /* Trust & Security Indicators */
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(5, 150, 105, 0.1);
            border-radius: 0.5rem;
            font-size: 0.813rem;
            color: var(--success);
            font-weight: 600;
            margin-top: 1rem;
        }

        .balance-card.total .security-badge {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            backdrop-filter: blur(10px);
            width: fit-content;
        }

        .balance-card.total .security-badge svg {
            stroke: white;
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            .balance-card {
                border-width: 3px;
            }
            .action-btn {
                border-width: 3px;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to Main Content Link (Accessibility) -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Navigation -->
    <nav class="nav" role="navigation" aria-label="Main navigation">
        <div class="nav-left">
            <a href="index.html" class="nav-brand" aria-label="UNERA Home">
                <svg class="nav-logo-icon" viewBox="0 0 140 140" aria-hidden="true">
                    <circle cx="70" cy="70" r="60" fill="#99F6E4"/>
                    <circle cx="70" cy="70" r="45" fill="#14B8A6"/>
                    <circle cx="70" cy="70" r="30" fill="#0F766E"/>
                    <circle cx="70" cy="70" r="15" fill="#FFFFFF"/>
                </svg>
                <div class="logo">UNERA</div>
            </a>
            <ul class="nav-links">
                <li><a href="dashboard-enhanced.html" class="nav-link">DASHBOARD</a></li>
                <li><a href="wallet-enhanced.html" class="nav-link" aria-current="page">WALLET</a></li>
                <li><a href="index.html#impact" class="nav-link">IMPACT</a></li>
                <li><a href="explore-centres.html" class="nav-link">CENTRES</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="container">
        <!-- KYC Alert Banner -->
        <div class="alert-banner" role="alert" aria-live="polite" id="kycAlert">
            <div class="alert-content">
                <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
                <div class="alert-text">
                    <div class="alert-title"> Complete Your Verification</div>
                    <div class="alert-description">Verify your identity to unlock full features and increase transaction limits</div>
                </div>
            </div>
            <div class="alert-actions">
                <button class="alert-cta" onclick="window.location.href='kyc-verify.html'" aria-label="Start verification process">
                    Verify Now
                </button>
                <button class="alert-dismiss" onclick="dismissAlert()" aria-label="Dismiss alert">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Page Header -->
        <header class="page-header">
            <p class="welcome-text">Your Impact Wallet</p>
            <h1 class="page-title">$8,250.00 Ready to Flow</h1>
            <p class="page-subtitle"> You've helped 120+ families across 3 centres  Manage funds & track giving</p>
        </header>

        <!-- Impact Summary Section -->
        <section class="impact-summary-wallet" aria-labelledby="impact-summary-title">
            <div class="impact-summary-header">
                <h2 id="impact-summary-title" class="section-title-small">Your Impact at a Glance</h2>
                <a href="dashboard-enhanced.html" class="view-link">View Details </a>
            </div>
            
            <div class="impact-stats-inline">
                <div class="impact-stat-mini">
                    <span class="stat-icon" aria-hidden="true"></span>
                    <div class="stat-content">
                        <span class="stat-value">$5,240</span>
                        <span class="stat-label">Total Given</span>
                    </div>
                </div>
                
                <div class="impact-stat-mini">
                    <span class="stat-icon" aria-hidden="true"></span>
                    <div class="stat-content">
                        <span class="stat-value">$486</span>
                        <span class="stat-label">Yield Generated</span>
                    </div>
                </div>
                
                <div class="impact-stat-mini">
                    <span class="stat-icon" aria-hidden="true"></span>
                    <div class="stat-content">
                        <span class="stat-value">3</span>
                        <span class="stat-label">Centres Supported</span>
                    </div>
                </div>
                
                <div class="impact-stat-mini">
                    <span class="stat-icon" aria-hidden="true"></span>
                    <div class="stat-content">
                        <span class="stat-value">120+</span>
                        <span class="stat-label">Lives Impacted</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Wallet Balances Section -->
        <section class="wallet-section" aria-labelledby="balances-title">
            <div class="section-header">
                <h2 id="balances-title" class="section-title">Balances</h2>
                <button 
                    class="privacy-toggle" 
                    onclick="toggleBalancePrivacy()" 
                    aria-label="Toggle balance visibility"
                    aria-pressed="true"
                    id="privacyToggle">
                    <svg class="privacy-toggle-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M13.875 18.825A10.05 10.05 0 0112 19c-7 0-11-8-11-8a18.988 18.988 0 015.125-5.172M9.879 9.879a3 3 0 004.242 4.242M9.879 9.879L6.343 6.343M9.879 9.879L6.343 6.343m7.536 7.536l3.536 3.536M9.879 9.879L6.343 6.343M9.879 9.879L6.343 6.343m7.536 7.536l3.536 3.536M2 2l20 20"/>
                    </svg>
                    <span id="privacyToggleText">Show Balances</span>
                </button>
            </div>

            <!-- BOSS REQUIREMENT: Asset Summary Panel -->
            <div class="asset-summary-panel">
                <div class="summary-stats">
                    <div class="summary-stat-card">
                        <span class="stat-label">Total Portfolio</span>
                        <div class="stat-value balance-amount" id="portfolioTotal">$8,250.00</div>
                        <span class="stat-change positive">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M18 15l-6-6-6 6"/>
                            </svg>
                            +3.2% this week
                        </span>
                    </div>
                    
                    <div class="summary-stat-card">
                        <span class="stat-label">Total Assets</span>
                        <div class="stat-value">4</div>
                        <span class="stat-detail">3 currencies + governance</span>
                    </div>
                    
                    <div class="summary-stat-card">
                        <span class="stat-label">Largest Holding</span>
                        <div class="stat-value">hCAD</div>
                        <span class="stat-detail balance-amount">$3,500 (42.4%)</span>
                    </div>
                </div>
                
                <!-- BOSS REQUIREMENT: Asset Distribution Visualization -->
                <div class="asset-distribution">
                    <h3>Portfolio Distribution</h3>
                    <div class="distribution-bars">
                        <div class="distribution-bar-item">
                            <div class="distribution-bar-header">
                                <span class="distribution-label">
                                    <span class="distribution-icon"></span>
                                    <span class="distribution-name">hCAD</span>
                                </span>
                                <span class="distribution-value balance-amount">$3,500  42.4%</span>
                            </div>
                            <div class="distribution-bar">
                                <div class="distribution-bar-fill hcad" style="width: 42.4%;" data-tooltip="hCAD: 42.4% of portfolio"></div>
                            </div>
                        </div>
                        
                        <div class="distribution-bar-item">
                            <div class="distribution-bar-header">
                                <span class="distribution-label">
                                    <span class="distribution-icon"></span>
                                    <span class="distribution-name">hUSD</span>
                                </span>
                                <span class="distribution-value balance-amount">$2,500  30.3%</span>
                            </div>
                            <div class="distribution-bar">
                                <div class="distribution-bar-fill husd" style="width: 30.3%;" data-tooltip="hUSD: 30.3% of portfolio"></div>
                            </div>
                        </div>
                        
                        <div class="distribution-bar-item">
                            <div class="distribution-bar-header">
                                <span class="distribution-label">
                                    <span class="distribution-icon"></span>
                                    <span class="distribution-name">hEUR</span>
                                </span>
                                <span class="distribution-value balance-amount">$1,400  17.0%</span>
                            </div>
                            <div class="distribution-bar">
                                <div class="distribution-bar-fill heur" style="width: 17.0%;" data-tooltip="hEUR: 17.0% of portfolio"></div>
                            </div>
                        </div>
                        
                        <div class="distribution-bar-item">
                            <div class="distribution-bar-header">
                                <span class="distribution-label">
                                    <span class="distribution-icon">H</span>
                                    <span class="distribution-name">HUMA</span>
                                </span>
                                <span class="distribution-value balance-amount">$850  10.3%</span>
                            </div>
                            <div class="distribution-bar">
                                <div class="distribution-bar-fill huma" style="width: 10.3%;" data-tooltip="HUMA: 10.3% of portfolio"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="balance-grid">
                <!-- Total Balance Card - Enhanced & Prominent -->
                <div class="balance-card total">
                    <div class="balance-header">
                        <div class="currency-info">
                            <div class="currency-icon" aria-hidden="true"></div>
                            <span class="currency-name">Total Balance</span>
                        </div>
                    </div>
                    <div class="balance-amount" id="totalBalance" aria-live="polite">$8,250.00</div>
                    <div class="balance-fiat">Combined value  All currencies</div>
                    <div class="security-badge" role="status">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        100% Backed by Reserves
                    </div>
                </div>

                <!-- hCAD Balance - ENHANCED PER BOSS REQUIREMENTS -->
                <div class="balance-card" data-asset="hCAD">
                    <div class="balance-header">
                        <div class="currency-info">
                            <div class="currency-icon" aria-label="Canadian Dollar"></div>
                            <span class="currency-name">hCAD</span>
                        </div>
                        <span class="balance-change positive" data-tooltip="Change in the past 7 days" role="status">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
                                <path d="M18 15l-6-6-6 6"/>
                            </svg>
                            +2.5%
                        </span>
                    </div>
                    
                    <!-- BOSS REQUIREMENT: Prominent Total Value -->
                    <div class="balance-value-section">
                        <div class="balance-amount-group">
                            <span class="balance-label">Balance</span>
                            <div class="balance-amount" id="hcadBalance">3,500.00</div>
                            <span class="balance-unit">hCAD</span>
                        </div>
                        
                        <div class="balance-fiat-value">
                            <span class="fiat-label">Total Value</span>
                            <div class="fiat-amount balance-amount">$3,500.00 CAD</div>
                        </div>
                    </div>
                    
                    <!-- BOSS REQUIREMENT: Per-Asset Quick Actions -->
                    <div class="asset-quick-actions">
                        <button class="asset-action-btn" onclick="addMoney('hCAD')" aria-label="Add hCAD funds" title="Add">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <button class="asset-action-btn" onclick="sendAsset('hCAD')" aria-label="Send hCAD" title="Send">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                            </svg>
                        </button>
                        <button class="asset-action-btn" onclick="swapAsset('hCAD')" aria-label="Swap hCAD" title="Swap">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- hUSD Balance - ENHANCED -->
                <div class="balance-card" data-asset="hUSD">
                    <div class="balance-header">
                        <div class="currency-info">
                            <div class="currency-icon" aria-label="US Dollar"></div>
                            <span class="currency-name">hUSD</span>
                        </div>
                        <span class="balance-change positive" data-tooltip="Change in the past 7 days" role="status">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
                                <path d="M18 15l-6-6-6 6"/>
                            </svg>
                            +1.2%
                        </span>
                    </div>
                    
                    <div class="balance-value-section">
                        <div class="balance-amount-group">
                            <span class="balance-label">Balance</span>
                            <div class="balance-amount" id="husdBalance">2,500.00</div>
                            <span class="balance-unit">hUSD</span>
                        </div>
                        
                        <div class="balance-fiat-value">
                            <span class="fiat-label">Total Value</span>
                            <div class="fiat-amount balance-amount">$2,500.00 USD</div>
                        </div>
                    </div>
                    
                    <div class="asset-quick-actions">
                        <button class="asset-action-btn" onclick="addMoney('hUSD')" aria-label="Add hUSD funds" title="Add">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <button class="asset-action-btn" onclick="sendAsset('hUSD')" aria-label="Send hUSD" title="Send">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                            </svg>
                        </button>
                        <button class="asset-action-btn" onclick="swapAsset('hUSD')" aria-label="Swap hUSD" title="Swap">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- hEUR Balance - ENHANCED -->
                <div class="balance-card" data-asset="hEUR">
                    <div class="balance-header">
                        <div class="currency-info">
                            <div class="currency-icon" aria-label="Euro"></div>
                            <span class="currency-name">hEUR</span>
                        </div>
                        <span class="balance-change negative" data-tooltip="Change in the past 7 days" role="status">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
                                <path d="M6 9l6 6 6-6"/>
                            </svg>
                            -0.5%
                        </span>
                    </div>
                    
                    <div class="balance-value-section">
                        <div class="balance-amount-group">
                            <span class="balance-label">Balance</span>
                            <div class="balance-amount" id="heurBalance">1,250.00</div>
                            <span class="balance-unit">hEUR</span>
                        </div>
                        
                        <div class="balance-fiat-value">
                            <span class="fiat-label">Total Value</span>
                            <div class="fiat-amount balance-amount">$1,400.00 USD</div>
                        </div>
                    </div>
                    
                    <div class="asset-quick-actions">
                        <button class="asset-action-btn" onclick="addMoney('hEUR')" aria-label="Add hEUR funds" title="Add">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <button class="asset-action-btn" onclick="sendAsset('hEUR')" aria-label="Send hEUR" title="Send">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                            </svg>
                        </button>
                        <button class="asset-action-btn" onclick="swapAsset('hEUR')" aria-label="Swap hEUR" title="Swap">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- HUMA Tokens - ENHANCED -->
                <div class="balance-card" data-asset="HUMA">
                    <div class="balance-header">
                        <div class="currency-info">
                            <div class="currency-icon" aria-label="HUMA Governance Token">H</div>
                            <div>
                                <span class="currency-name">HUMA</span>
                                <span class="info-icon" 
                                      tabindex="0" 
                                      role="tooltip" 
                                      data-tooltip="Governance tokens earned through donations. Vote on community decisions."
                                      aria-label="Information about HUMA tokens">i</span>
                            </div>
                        </div>
                        <span class="balance-change positive" data-tooltip="Change in the past 7 days" role="status">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
                                <path d="M18 15l-6-6-6 6"/>
                            </svg>
                            +5.2%
                        </span>
                    </div>
                    
                    <div class="balance-value-section">
                        <div class="balance-amount-group">
                            <span class="balance-label">Balance</span>
                            <div class="balance-amount" id="humaBalance">425.50</div>
                            <span class="balance-unit">HUMA</span>
                        </div>
                        
                        <div class="balance-fiat-value governance">
                            <span class="fiat-label">Governance Tokens</span>
                            <div class="fiat-amount balance-amount"> $850.00 USD</div>
                            <span class="fiat-detail">Earned through donations</span>
                        </div>
                    </div>
                    
                    <div class="asset-quick-actions">
                        <button class="asset-action-btn" onclick="earnMore()" aria-label="Earn more HUMA" title="Earn More">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <button class="asset-action-btn" onclick="voteWithHuma()" aria-label="Vote with HUMA" title="Vote">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </button>
                        <button class="asset-action-btn" onclick="learnMore()" aria-label="Learn about HUMA" title="Learn More">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Actions - 4 Core Actions (Consolidated) -->
            <div class="quick-actions" role="group" aria-label="Wallet actions">
                <button class="action-btn" onclick="window.location.href='add-money.html'" aria-label="Add money to wallet">
                    <svg class="action-btn-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    <span>Add Money</span>
                </button>

                <button class="action-btn" onclick="window.location.href='withdraw.html'" aria-label="Withdraw to bank">
                    <svg class="action-btn-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                    </svg>
                    <span>Withdraw</span>
                </button>

                <button class="action-btn primary" onclick="window.location.href='send-enhanced.html'" aria-label="Send money or donate - Recommended action">
                    <svg class="action-btn-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                    </svg>
                    <span>Send</span>
                </button>

                <button class="action-btn" onclick="handleAction('receive')" aria-label="Receive money">
                    <svg class="action-btn-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m0 0l-4-4m4 4l4-4"/>
                    </svg>
                    <span>Receive</span>
                </button>
            </div>
        </section>

        <!-- Transaction History Section -->
        <section class="history-section" aria-labelledby="history-title">
            <div class="section-header">
                <h2 id="history-title" class="section-title">Transaction History</h2>
            </div>

            <!-- Search and Filters -->
            <div class="history-controls">
                <div class="search-bar">
                    <svg class="search-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input 
                        type="search" 
                        class="search-input" 
                        placeholder="Search by name, amount, category, or note..." 
                        id="searchInput"
                        aria-label="Search transactions by name, amount, category, or note"
                        oninput="searchTransactions()"
                        autocomplete="off">
                    <button class="search-clear-btn" id="searchClearBtn" onclick="clearSearch()" aria-label="Clear search" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <button 
                    class="filter-btn" 
                    onclick="toggleFilterPanel()" 
                    id="filterBtn"
                    aria-label="Open filter panel"
                    aria-expanded="false">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                    </svg>
                    <span>Filters</span>
                </button>
            </div>

            <!-- Active Filters Display -->
            <div class="active-filters" id="activeFilters" style="display: none;" role="region" aria-label="Active filters">
                <!-- Filter chips populated by JavaScript -->
            </div>

            <!-- Export Button (shows when filters are active) -->
            <div class="export-container" id="exportContainer" style="display: none;">
                <button class="export-btn" onclick="showExportDialog()" aria-label="Export filtered transactions">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span>Export Results</span>
                </button>
            </div>

            <!-- Transaction List -->
            <div class="transaction-list" role="list" aria-label="Transactions" id="transactionList">
                <!-- Today -->
                <div class="date-group">
                    <div class="date-header">Today</div>
                    
                    <!-- Transaction 1: Received -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx001')" 
                         role="button" 
                         tabindex="0"
                         onkeypress="if(event.key==='Enter') showTransactionDetail('tx001')"
                         aria-label="Received $500.00 from Alice Johnson">
                        <div class="transaction-icon in" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Received from Alice Johnson</div>
                            <div class="transaction-meta">
                                <span>10:32 AM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>hUSD</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary positive">+ $500.00</div>
                            <div class="amount-secondary">hUSD</div>
                        </div>
                    </div>

                    <!-- Transaction 2: Donation -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx002')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Donated $250.00 to Nairobi Humanity Centre">
                        <div class="transaction-icon donation" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Donation to Nairobi Humanity Centre</div>
                            <div class="transaction-meta">
                                <span>09:15 AM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>hCAD</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary negative">- $250.00</div>
                            <div class="amount-secondary">Earned 25 HUMA</div>
                        </div>
                    </div>

                    <!-- Transaction 3: Pending Bank Transfer -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx003')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Pending bank transfer of $1,000.00">
                        <div class="transaction-icon pending" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Bank Transfer In</div>
                            <div class="transaction-meta">
                                <span>08:45 AM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status pending" role="status">Pending</span>
                                <span aria-hidden="true"></span>
                                <span>hCAD</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary positive">+ $1,000.00</div>
                            <div class="amount-secondary">Est. 2-3 days</div>
                        </div>
                    </div>

                    <!-- Transaction 4: Yield Earned -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx004')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Earned $12.50 yield">
                        <div class="transaction-icon yield" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Yield Earned - Monthly Distribution</div>
                            <div class="transaction-meta">
                                <span>06:00 AM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>hCAD</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary positive">+ $12.50</div>
                            <div class="amount-secondary">4.8% APY</div>
                        </div>
                    </div>
                </div>

                <!-- Yesterday -->
                <div class="date-group">
                    <div class="date-header">Yesterday</div>
                    
                    <!-- Transaction 5: Sent to Friend -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx005')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Sent $75.00 to Bob Chen">
                        <div class="transaction-icon out" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Sent to Bob Chen</div>
                            <div class="transaction-meta">
                                <span>Yesterday, 3:20 PM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>hUSD</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary negative">- $75.00</div>
                            <div class="amount-secondary">Split dinner</div>
                        </div>
                    </div>

                    <!-- Transaction 6: Currency Conversion -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx006')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Converted $200 CAD to USD">
                        <div class="transaction-icon convert" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Converted hCAD  hUSD</div>
                            <div class="transaction-meta">
                                <span>Yesterday, 11:45 AM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>Exchange</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary neutral">$200.00</div>
                            <div class="amount-secondary">Rate: 1.35</div>
                        </div>
                    </div>

                    <!-- Transaction 7: Donation to Toronto Centre -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx007')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Donated $500 to Toronto Humanity Centre">
                        <div class="transaction-icon donation" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Donation to Toronto Humanity Centre</div>
                            <div class="transaction-meta">
                                <span>Yesterday, 9:00 AM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>hCAD</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary negative">- $500.00</div>
                            <div class="amount-secondary">Earned 50 HUMA</div>
                        </div>
                    </div>
                </div>

                <!-- Jan 14 -->
                <div class="date-group">
                    <div class="date-header">Jan 14, 2026</div>
                    
                    <!-- Transaction 8: Card Payment -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx008')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Added $300 via credit card">
                        <div class="transaction-icon in" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Added Funds via Card</div>
                            <div class="transaction-meta">
                                <span>Jan 14, 2:15 PM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>Visa  4242</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary positive">+ $300.00</div>
                            <div class="amount-secondary">hUSD</div>
                        </div>
                    </div>

                    <!-- Transaction 9: Reward/HUMA Earned -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx009')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Earned 15 HUMA tokens as reward">
                        <div class="transaction-icon reward" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Referral Bonus Earned</div>
                            <div class="transaction-meta">
                                <span>Jan 14, 10:30 AM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>HUMA</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary positive">+ 15 HUMA</div>
                            <div class="amount-secondary"> $150 USD</div>
                        </div>
                    </div>

                    <!-- Transaction 10: Interac Transfer -->
                    <div class="transaction-item" 
                         onclick="showTransactionDetail('tx010')" 
                         role="button" 
                         tabindex="0"
                         aria-label="Received $850 via Interac e-Transfer">
                        <div class="transaction-icon in" aria-hidden="true"></div>
                        <div class="transaction-details">
                            <div class="transaction-title">Interac e-Transfer from Maria Garcia</div>
                            <div class="transaction-meta">
                                <span>Jan 14, 8:00 AM</span>
                                <span aria-hidden="true"></span>
                                <span class="transaction-status completed" role="status">Completed</span>
                                <span aria-hidden="true"></span>
                                <span>hCAD</span>
                            </div>
                        </div>
                        <div class="transaction-amount">
                            <div class="amount-primary positive">+ $850.00</div>
                            <div class="amount-secondary">Rent payment</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Load More Transactions -->
            <div class="load-more-container" id="loadMoreContainer">
                <div class="transaction-count" role="status" aria-live="polite" id="transactionCount">
                    Showing <span id="shownCount">10</span> of <span id="totalCount">247</span> transactions
                </div>
                <button class="load-more-btn" id="loadMoreBtn" onclick="loadMoreTransactions()" aria-label="Load more transactions">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                    </svg>
                    <span id="loadMoreText">Load More Transactions</span>
                </button>
                
                <!-- Loading indicator -->
                <div class="loading-indicator" id="loadingIndicator" style="display: none;" role="status" aria-live="polite">
                    <div class="spinner"></div>
                    <span>Loading transactions...</span>
                </div>
                
                <!-- Infinite scroll sentinel -->
                <div id="scrollSentinel" style="height: 1px;"></div>
            </div>

            <!-- Empty State (initially hidden) -->
            <div class="empty-state" id="emptyState" style="display: none;" role="status">
                <svg class="empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <h3 class="empty-title">No transactions found</h3>
                <p class="empty-text">Try adjusting your filters or search terms, or start by adding funds to your wallet.</p>
                <button class="empty-action" onclick="window.location.href='convert.html'">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Add Funds Now
                </button>
            </div>
        </section>
    </main>

    <!-- Transaction Detail Modal -->
    <div class="modal-overlay" 
         id="detailModal" 
         role="dialog" 
         aria-modal="true" 
         aria-labelledby="modalTitle"
         onclick="closeDetailModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" 
                    onclick="closeDetailModal()" 
                    aria-label="Close transaction details"
                    id="modalCloseBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Transaction Details</h3>
            </div>
            <div class="modal-body" id="detailContent">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Filter Panel Modal -->
    <div class="filter-modal" id="filterModal" role="dialog" aria-modal="true" aria-labelledby="filterModalTitle" aria-hidden="true">
        <div class="filter-modal-overlay" onclick="closeFilterPanel()"></div>
        <div class="filter-modal-content" onclick="event.stopPropagation()">
            <div class="filter-modal-header">
                <h2 id="filterModalTitle">Filter Transactions</h2>
                <button class="modal-close-btn" onclick="closeFilterPanel()" aria-label="Close filter panel">
                    <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="filter-modal-body">
                <!-- Date Range Filter -->
                <div class="filter-section">
                    <h3>Date Range</h3>
                    <div class="date-range-presets">
                        <button type="button" class="date-preset-btn" onclick="setDateRange('last7days')" aria-label="Filter last 7 days">Last 7 days</button>
                        <button type="button" class="date-preset-btn" onclick="setDateRange('last30days')" aria-label="Filter last 30 days">Last 30 days</button>
                        <button type="button" class="date-preset-btn" onclick="setDateRange('thisMonth')" aria-label="Filter this month">This month</button>
                    </div>
                    <div class="date-range-custom">
                        <label for="dateFrom">
                            From:
                            <input type="date" id="dateFrom" aria-label="Filter from date">
                        </label>
                        <label for="dateTo">
                            To:
                            <input type="date" id="dateTo" aria-label="Filter to date">
                        </label>
                    </div>
                </div>

                <!-- Transaction Type Filter -->
                <div class="filter-section">
                    <h3>Transaction Type</h3>
                    <div class="radio-group" role="radiogroup" aria-label="Transaction type">
                        <label class="radio-label">
                            <input type="radio" name="txType" value="all" checked>
                            <span>All Transactions</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="txType" value="in">
                            <span> Money In</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="txType" value="out">
                            <span> Money Out</span>
                        </label>
                    </div>
                </div>

                <!-- Category Filter -->
                <div class="filter-section">
                    <h3>Category</h3>
                    <div class="checkbox-group" role="group" aria-label="Categories">
                        <label class="checkbox-label">
                            <input type="checkbox" value="received" id="cat-received">
                            <span> Received</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="donation" id="cat-donation">
                            <span> Donations</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="transfer" id="cat-transfer">
                            <span> Transfers</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="yield" id="cat-yield">
                            <span> Yield/Interest</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="bank" id="cat-bank">
                            <span> Bank Transfers</span>
                        </label>
                    </div>
                </div>

                <!-- Status Filter -->
                <div class="filter-section">
                    <h3>Status</h3>
                    <div class="checkbox-group" role="group" aria-label="Transaction status">
                        <label class="checkbox-label">
                            <input type="checkbox" value="completed" id="status-completed" checked>
                            <span> Completed</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="pending" id="status-pending" checked>
                            <span> Pending</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="failed" id="status-failed">
                            <span> Failed</span>
                        </label>
                    </div>
                </div>

                <!-- Currency Filter -->
                <div class="filter-section">
                    <h3>Currency</h3>
                    <label for="currencyFilter" class="sr-only">Filter by currency</label>
                    <select id="currencyFilter" aria-label="Filter by currency">
                        <option value="all">All Currencies</option>
                        <option value="hUSD">hUSD</option>
                        <option value="hCAD">hCAD</option>
                        <option value="hEUR">hEUR</option>
                        <option value="hGBP">hGBP</option>
                        <option value="hJPY">hJPY</option>
                    </select>
                </div>

                <!-- Saved Filter Presets -->
                <div class="filter-section">
                    <h3>Saved Presets</h3>
                    <div class="filter-presets" id="filterPresets">
                        <!-- Presets populated by JavaScript -->
                        <p class="filter-presets-empty" id="presetsEmpty">No saved presets yet</p>
                    </div>
                    <button type="button" class="btn-save-preset" onclick="showSavePresetDialog()" aria-label="Save current filters as preset">
                        <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                        </svg>
                        Save Current Filters
                    </button>
                </div>
            </div>
            
            <div class="filter-modal-footer">
                <button type="button" class="btn-secondary" onclick="clearAllFilters()" aria-label="Clear all filters">Clear All</button>
                <button type="button" class="btn-primary" onclick="applyFilters()" aria-label="Apply filters">Apply Filters</button>
            </div>
        </div>
    </div>

    <!-- Save Preset Dialog -->
    <div class="preset-dialog" id="presetDialog" role="dialog" aria-modal="true" aria-labelledby="presetDialogTitle" aria-hidden="true">
        <div class="preset-dialog-overlay" onclick="closeSavePresetDialog()"></div>
        <div class="preset-dialog-content" onclick="event.stopPropagation()">
            <h3 id="presetDialogTitle">Save Filter Preset</h3>
            <p>Give your filter preset a name:</p>
            <input type="text" id="presetNameInput" placeholder="e.g., My Donations" maxlength="30" aria-label="Preset name">
            <div class="preset-dialog-actions">
                <button type="button" class="btn-secondary" onclick="closeSavePresetDialog()">Cancel</button>
                <button type="button" class="btn-primary" onclick="saveFilterPreset()" id="savePresetBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Export Dialog -->
    <div class="export-dialog" id="exportDialog" role="dialog" aria-modal="true" aria-labelledby="exportDialogTitle" aria-hidden="true">
        <div class="export-dialog-overlay" onclick="closeExportDialog()"></div>
        <div class="export-dialog-content" onclick="event.stopPropagation()">
            <h3 id="exportDialogTitle">Export Transactions</h3>
            <p>Choose export format for your filtered transactions:</p>
            
            <div class="export-options">
                <button class="export-option-btn" onclick="exportTransactions('csv')">
                    <svg width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <div>
                        <strong>CSV File</strong>
                        <span>Spreadsheet format</span>
                    </div>
                </button>
                
                <button class="export-option-btn" onclick="exportTransactions('pdf')">
                    <svg width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                    </svg>
                    <div>
                        <strong>PDF Statement</strong>
                        <span>Printable document</span>
                    </div>
                </button>
                
                <button class="export-option-btn" onclick="exportTransactions('json')">
                    <svg width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                    </svg>
                    <div>
                        <strong>JSON Data</strong>
                        <span>Developer format</span>
                    </div>
                </button>
            </div>
            
            <div class="export-info">
                <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span id="exportInfo">Exporting <strong>0</strong> visible transactions</span>
            </div>
            
            <div class="export-dialog-footer">
                <button type="button" class="btn-secondary" onclick="closeExportDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Screen Reader Announcements -->
    <div class="sr-only" role="status" aria-live="polite" aria-atomic="true" id="searchAnnouncer"></div>

    <script>
        // Mock transaction data
        const mockTransactions = {
            'tx001': {
                id: 'TX-2026-001-5A3F',
                type: 'received',
                from: 'Alice Johnson (alice@example.com)',
                to: 'Your hUSD Wallet',
                amount: 500.00,
                currency: 'hUSD',
                status: 'completed',
                date: 'Jan 16, 2026 10:32 AM',
                fee: 0.00,
                reference: 'Payment for consulting services',
                confirmations: 12,
                impact: 'This transaction supports community financial inclusion.',
                blockExplorer: 'https://explorer.unera.org/tx/5A3F'
            },
            'tx002': {
                id: 'TX-2026-002-8B9D',
                type: 'donation',
                from: 'Your hCAD Wallet',
                to: 'Nairobi Humanity Centre',
                amount: 250.00,
                currency: 'hCAD',
                status: 'completed',
                date: 'Jan 16, 2026 09:15 AM',
                fee: 0.50,
                reference: 'Monthly donation',
                humaEarned: 25.00,
                impact: 'Your donation helps provide education and resources to 50+ families in Nairobi.',
                category: 'Donation'
            },
            'tx003': {
                id: 'TX-2026-003-2C4E',
                type: 'deposit',
                from: 'TD Bank  1234',
                to: 'Your hCAD Wallet',
                amount: 1000.00,
                currency: 'hCAD',
                status: 'pending',
                date: 'Jan 16, 2026 08:45 AM',
                fee: 0.00,
                reference: 'Bank transfer',
                estimatedCompletion: '2-3 business days',
                impact: 'Processing securely through our banking partners.'
            },
            'tx004': {
                id: 'TX-2026-004-7F2B',
                type: 'yield',
                from: 'UNERA Yield Pool',
                to: 'Your hCAD Wallet',
                amount: 12.50,
                currency: 'hCAD',
                status: 'completed',
                date: 'Jan 16, 2026 06:00 AM',
                fee: 0.00,
                reference: 'Monthly yield distribution - 4.8% APY',
                impact: 'Automated yield from your stablecoin holdings.',
                category: 'Yield'
            },
            'tx005': {
                id: 'TX-2026-005-3D8A',
                type: 'sent',
                from: 'Your hUSD Wallet',
                to: 'Bob Chen (bob@example.com)',
                amount: 75.00,
                currency: 'hUSD',
                status: 'completed',
                date: 'Jan 15, 2026 3:20 PM',
                fee: 0.25,
                reference: 'Split dinner',
                impact: 'Instant peer-to-peer payment.',
                category: 'Payment'
            },
            'tx006': {
                id: 'TX-2026-006-9E4C',
                type: 'conversion',
                from: 'Your hCAD Wallet',
                to: 'Your hUSD Wallet',
                amount: 200.00,
                currency: 'hCAD',
                amountReceived: 148.15,
                currencyReceived: 'hUSD',
                exchangeRate: 1.35,
                status: 'completed',
                date: 'Jan 15, 2026 11:45 AM',
                fee: 1.00,
                reference: 'Currency conversion CAD  USD',
                impact: 'Real-time exchange at market rates.'
            },
            'tx007': {
                id: 'TX-2026-007-1B6F',
                type: 'donation',
                from: 'Your hCAD Wallet',
                to: 'Toronto Humanity Centre',
                amount: 500.00,
                currency: 'hCAD',
                status: 'completed',
                date: 'Jan 15, 2026 9:00 AM',
                fee: 0.50,
                reference: 'Supporting local community',
                humaEarned: 50.00,
                impact: 'Your donation helped provide food and shelter to 100+ families in Toronto.',
                category: 'Donation'
            },
            'tx008': {
                id: 'TX-2026-008-4C2D',
                type: 'deposit',
                from: 'Visa  4242',
                to: 'Your hUSD Wallet',
                amount: 300.00,
                currency: 'hUSD',
                status: 'completed',
                date: 'Jan 14, 2026 2:15 PM',
                fee: 7.50,
                reference: 'Card payment - 2.5% processing fee',
                impact: 'Instant funding via credit card.',
                category: 'Deposit'
            },
            'tx009': {
                id: 'TX-2026-009-8A7E',
                type: 'reward',
                from: 'UNERA Referral Program',
                to: 'Your HUMA Wallet',
                amount: 15.00,
                currency: 'HUMA',
                status: 'completed',
                date: 'Jan 14, 2026 10:30 AM',
                fee: 0.00,
                reference: 'Referral bonus - Sarah joined UNERA',
                impact: 'Earn rewards for growing the UNERA community!',
                category: 'Reward'
            },
            'tx010': {
                id: 'TX-2026-010-5B9C',
                type: 'received',
                from: 'Maria Garcia (Interac e-Transfer)',
                to: 'Your hCAD Wallet',
                amount: 850.00,
                currency: 'hCAD',
                status: 'completed',
                date: 'Jan 14, 2026 8:00 AM',
                fee: 0.00,
                reference: 'Rent payment - January',
                impact: 'Free Interac e-Transfer deposits.',
                category: 'Payment'
            }
        };

        // Toggle balance privacy with state management
        let balancesHidden = true; // Start with balances hidden by default
        
        function toggleBalancePrivacy() {
            balancesHidden = !balancesHidden;
            const amounts = document.querySelectorAll('.balance-amount');
            const btn = document.getElementById('privacyToggle');
            const icon = btn.querySelector('.privacy-toggle-icon');
            const text = document.getElementById('privacyToggleText');
            
            amounts.forEach(amount => {
                amount.classList.toggle('hidden', balancesHidden);
            });

            btn.setAttribute('aria-pressed', balancesHidden);
            
            if (balancesHidden) {
                icon.innerHTML = '<path d="M13.875 18.825A10.05 10.05 0 0112 19c-7 0-11-8-11-8a18.988 18.988 0 015.125-5.172M9.879 9.879a3 3 0 004.242 4.242M9.879 9.879L6.343 6.343M9.879 9.879L6.343 6.343m7.536 7.536l3.536 3.536M9.879 9.879L6.343 6.343M9.879 9.879L6.343 6.343m7.536 7.536l3.536 3.536M2 2l20 20"/>';
                text.textContent = 'Show Balances';
            } else {
                icon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
                text.textContent = 'Hide Balances';
            }
        }
        
        // Initialize balances as hidden on page load
        function initializePrivacy() {
            const amounts = document.querySelectorAll('.balance-amount');
            const btn = document.getElementById('privacyToggle');
            const icon = btn.querySelector('.privacy-toggle-icon');
            const text = document.getElementById('privacyToggleText');
            
            // Hide balances
            amounts.forEach(amount => {
                amount.classList.add('hidden');
            });
            
            // Update button state
            btn.setAttribute('aria-pressed', 'true');
            icon.innerHTML = '<path d="M13.875 18.825A10.05 10.05 0 0112 19c-7 0-11-8-11-8a18.988 18.988 0 015.125-5.172M9.879 9.879a3 3 0 004.242 4.242M9.879 9.879L6.343 6.343M9.879 9.879L6.343 6.343m7.536 7.536l3.536 3.536M9.879 9.879L6.343 6.343M9.879 9.879L6.343 6.343m7.536 7.536l3.536 3.536M2 2l20 20"/>';
            text.textContent = 'Show Balances';
        }
        
        // Call initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePrivacy);
        } else {
            initializePrivacy();
        }

        // Handle action buttons with loading state
        function handleAction(action) {
            const button = event.currentTarget;
            button.classList.add('loading');
            button.setAttribute('aria-busy', 'true');
            
            // Simulate action delay
            setTimeout(() => {
                button.classList.remove('loading');
                button.setAttribute('aria-busy', 'false');
                
                // Navigate based on action
                const routes = {
                    'add': 'convert.html',
                    'send': 'send-enhanced.html',
                    'donate': 'donate.html',
                    'export': null
                };
                
                if (routes[action]) {
                    window.location.href = routes[action];
                } else if (action === 'export') {
                    alert('Export functionality will generate a CSV/PDF file with your transaction history.');
                }
            }, 800);
        }

        // ========================================
        // BOSS REQUIREMENTS: PER-ASSET ACTIONS (PROTOTYPE)
        // ========================================

        function addMoney(asset) {
            console.log(' Add money to', asset);
            const button = event.currentTarget;
            button.classList.add('loading');
            
            setTimeout(() => {
                button.classList.remove('loading');
                // PROTOTYPE: Show alert (real app would navigate)
                alert(` Add Money - ${asset}\n\nThis would navigate to the Add Money flow where you can:\n\n Link your bank account\n Add via credit/debit card\n Transfer from another wallet\n\nSpecific to: ${asset}`);
            }, 600);
        }

        function sendAsset(asset) {
            console.log(' Send', asset);
            const button = event.currentTarget;
            button.classList.add('loading');
            
            setTimeout(() => {
                button.classList.remove('loading');
                // PROTOTYPE: Show alert (real app would navigate to send-enhanced.html?asset=X)
                alert(` Send ${asset}\n\nThis would navigate to the Send flow with:\n\n ${asset} pre-selected as currency\n Recipient address field\n Amount input\n Transaction fee display\n\nReady to send ${asset}!`);
            }, 600);
        }

        function swapAsset(asset) {
            console.log(' Swap', asset);
            const button = event.currentTarget;
            button.classList.add('loading');
            
            setTimeout(() => {
                button.classList.remove('loading');
                // PROTOTYPE: Show alert (real app would navigate to swap.html)
                alert(` Swap ${asset}\n\nThis would open the Currency Swap interface:\n\n From: ${asset}\n To: [Select currency]\n Live exchange rates\n No fees for swaps\n\nSwap your ${asset} for other assets!`);
            }, 600);
        }

        // HUMA-specific actions
        function earnMore() {
            console.log(' Earn more HUMA');
            alert(' Earn More HUMA Tokens\n\nDonate to verified community centres to earn HUMA governance tokens!\n\n $10 donation = 1 HUMA\n Quarterly bonus multipliers\n Higher tier = more rewards\n\nWould navigate to: donate.html');
        }

        function voteWithHuma() {
            console.log(' Vote with HUMA');
            alert(' Governance Voting\n\nUse your HUMA tokens to vote on:\n\n New community initiatives\n Fund allocation decisions\n Platform governance\n Centre partnerships\n\nYour voice matters!\n\nWould navigate to: governance.html');
        }

        function learnMore() {
            console.log(' Learn about HUMA');
            alert(' About HUMA Tokens\n\n Governance tokens earned through donations\n Vote on community decisions\n Stake for additional rewards\n Support global impact initiatives\n\nCurrent Value: $2.00 per HUMA\nYour Holdings: 425.50 HUMA = $850.00\n\nWould navigate to: about-huma.html');
        }

        // Show transaction detail modal with enhanced context
        function showTransactionDetail(txId) {
            const tx = mockTransactions[txId];
            if (!tx) return;

            const content = `
                <div class="detail-row">
                    <span class="detail-label">Transaction ID</span>
                    <span class="detail-value">
                        ${tx.id}
                    </span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Date & Time</span>
                    <span class="detail-value">${tx.date}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status</span>
                    <span class="detail-value">
                        <span class="transaction-status ${tx.status}">${tx.status.charAt(0).toUpperCase() + tx.status.slice(1)}</span>
                    </span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">From</span>
                    <span class="detail-value">${tx.from}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">To</span>
                    <span class="detail-value">${tx.to}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Amount</span>
                    <span class="detail-value" style="font-weight: 700; font-size: 1.125rem;">${tx.amount.toFixed(2)} ${tx.currency}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Network Fee</span>
                    <span class="detail-value">${tx.fee.toFixed(2)} ${tx.currency}</span>
                </div>
                ${tx.humaEarned ? `<div class="detail-row">
                    <span class="detail-label">HUMA Earned</span>
                    <span class="detail-value" style="color: var(--success); font-weight: 700;">${tx.humaEarned} HUMA</span>
                </div>` : ''}
                ${tx.reference ? `<div class="detail-row">
                    <span class="detail-label">Reference</span>
                    <span class="detail-value">${tx.reference}</span>
                </div>` : ''}
                ${tx.confirmations ? `<div class="detail-row">
                    <span class="detail-label">Confirmations</span>
                    <span class="detail-value">${tx.confirmations}/12</span>
                </div>` : ''}
                ${tx.estimatedCompletion ? `<div class="detail-row">
                    <span class="detail-label">Est. Completion</span>
                    <span class="detail-value">${tx.estimatedCompletion}</span>
                </div>` : ''}
                ${tx.impact ? `<div class="detail-row">
                    <span class="detail-label">Impact</span>
                    <span class="detail-value" style="font-style: italic;">${tx.impact}</span>
                </div>` : ''}
            `;

            document.getElementById('detailContent').innerHTML = content;
            const modal = document.getElementById('detailModal');
            modal.classList.add('active');
            
            // Focus trap
            setTimeout(() => {
                document.getElementById('modalCloseBtn').focus();
            }, 100);
        }

        function closeDetailModal(event) {
            if (!event || event.target.id === 'detailModal') {
                document.getElementById('detailModal').classList.remove('active');
            }
        }

        // Keyboard navigation for modal
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('detailModal');
            if (modal.classList.contains('active') && e.key === 'Escape') {
                closeDetailModal();
            }
        });

        // Transaction Search & Filter - MVP Implementation
        let searchTimeout = null;
        let activeFilters = {
            dateFrom: null,
            dateTo: null,
            type: 'all',
            categories: [],
            statuses: ['completed', 'pending'],
            currency: 'all'
        };

        // Enhanced Search Function
        function searchTransactions() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            
            // Clear previous timeout
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }
            
            // Debounce search by 300ms
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300);
        }

        function performSearch(query) {
            const transactionItems = document.querySelectorAll('.transaction-item');
            let matchCount = 0;
            let totalCount = transactionItems.length;
            
            // Show/hide clear button
            const clearBtn = document.getElementById('searchClearBtn');
            if (clearBtn) {
                clearBtn.style.display = query ? 'flex' : 'none';
            }
            
            if (!query) {
                // Show all transactions if no query
                transactionItems.forEach(item => {
                    item.style.display = 'flex';
                    clearHighlights(item); // Clear any highlights
                });
                matchCount = totalCount;
            } else {
                // Search across multiple fields
                transactionItems.forEach(item => {
                    const title = item.querySelector('.transaction-title')?.textContent || '';
                    const meta = item.querySelector('.transaction-meta')?.textContent || '';
                    const amount = item.querySelector('.amount-primary')?.textContent || '';
                    const ariaLabel = item.getAttribute('aria-label') || '';
                    
                    // Combine all searchable text
                    const searchableText = `${title} ${meta} ${amount} ${ariaLabel}`.toLowerCase();
                    
                    // Check for matches (including amount operators)
                    let matches = false;
                    
                    if (query.startsWith('>') || query.startsWith('<')) {
                        // Amount operator search
                        matches = matchesAmountOperator(amount, query);
                    } else {
                        // Regular text search
                        matches = searchableText.includes(query);
                    }
                    
                    if (matches) {
                        item.style.display = 'flex';
                        highlightMatch(item, query);
                        matchCount++;
                    } else {
                        item.style.display = 'none';
                    }
                });
            }
            
            // Handle empty date groups
            hideEmptyDateGroups();
            
            // Show/hide empty state
            if (matchCount === 0) {
                document.getElementById('transactionList').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                announceToScreenReader(`No transactions found for "${query}"`);
            } else {
                document.getElementById('transactionList').style.display = 'block';
                document.getElementById('emptyState').style.display = 'none';
                announceToScreenReader(`Found ${matchCount} of ${totalCount} transactions`);
            }
        }

        function matchesAmountOperator(amountText, query) {
            // Extract number from amount text (e.g., "+ $500.00" -> 500)
            const numberMatch = amountText.match(/[\d,]+\.?\d*/);
            if (!numberMatch) return false;
            
            const amount = parseFloat(numberMatch[0].replace(/,/g, ''));
            const operator = query.charAt(0);
            const queryAmount = parseFloat(query.substring(1));
            
            if (isNaN(queryAmount)) return false;
            
            if (operator === '>') {
                return amount > queryAmount;
            } else if (operator === '<') {
                return amount < queryAmount;
            }
            
            return false;
        }

        // ========================================
        // PHASE 5: SEARCH HIGHLIGHTING
        // ========================================
        
        function highlightMatch(item, query) {
            if (!query) {
                clearHighlights(item);
                return;
            }
            
            // Get text elements to highlight
            const title = item.querySelector('.transaction-title');
            const meta = item.querySelector('.transaction-meta');
            const amount = item.querySelector('.amount-primary');
            
            if (title) highlightText(title, query);
            if (meta) highlightText(meta, query);
            if (amount && !query.startsWith('>') && !query.startsWith('<')) {
                highlightText(amount, query);
            }
        }

        function highlightText(element, query) {
            // Store original text if not already stored
            if (!element.hasAttribute('data-original-text')) {
                element.setAttribute('data-original-text', element.textContent);
            }
            
            const originalText = element.getAttribute('data-original-text');
            const escapedQuery = escapeRegExp(query);
            const regex = new RegExp(`(${escapedQuery})`, 'gi');
            
            // Replace matches with highlighted version
            const highlightedHTML = originalText.replace(regex, '<mark class="search-highlight">$1</mark>');
            
            // Only update if there were matches
            if (highlightedHTML !== originalText) {
                element.innerHTML = highlightedHTML;
            }
        }

        function clearHighlights(item) {
            const elementsWithHighlight = item.querySelectorAll('[data-original-text]');
            elementsWithHighlight.forEach(el => {
                const originalText = el.getAttribute('data-original-text');
                el.textContent = originalText;
            });
        }

        function clearAllHighlights() {
            document.querySelectorAll('[data-original-text]').forEach(el => {
                const originalText = el.getAttribute('data-original-text');
                el.textContent = originalText;
                el.removeAttribute('data-original-text');
            });
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function hideEmptyDateGroups() {
            const dateGroups = document.querySelectorAll('.date-group');
            dateGroups.forEach(group => {
                const visibleItems = Array.from(group.querySelectorAll('.transaction-item'))
                    .filter(item => item.style.display !== 'none');
                
                if (visibleItems.length === 0) {
                    group.style.display = 'none';
                } else {
                    group.style.display = 'block';
                }
            });
        }

        // Clear Search
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            const clearBtn = document.getElementById('searchClearBtn');
            if (clearBtn) clearBtn.style.display = 'none';
            performSearch('');
            clearAllHighlights();
        }

        // Filter Panel Functions
        let lastFocusedElement = null;

        function toggleFilterPanel() {
            const modal = document.getElementById('filterModal');
            if (modal.classList.contains('active')) {
                closeFilterPanel();
            } else {
                openFilterPanel();
            }
        }

        function openFilterPanel() {
            lastFocusedElement = document.activeElement;
            
            const modal = document.getElementById('filterModal');
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            
            // Focus first interactive element
            const firstInput = modal.querySelector('button, input, select');
            if (firstInput) {
                setTimeout(() => firstInput.focus(), 100);
            }
            
            // Trap focus
            trapFocus(modal);
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }

        function closeFilterPanel() {
            const modal = document.getElementById('filterModal');
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            
            // Restore body scroll
            document.body.style.overflow = '';
            
            // Return focus
            if (lastFocusedElement) {
                lastFocusedElement.focus();
            }
        }

        // Focus Trap for Accessibility
        function trapFocus(modal) {
            const focusableElements = modal.querySelectorAll(
                'button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            
            const handleKeyDown = (e) => {
                if (e.key === 'Tab') {
                    if (e.shiftKey && document.activeElement === firstElement) {
                        e.preventDefault();
                        lastElement.focus();
                    } else if (!e.shiftKey && document.activeElement === lastElement) {
                        e.preventDefault();
                        firstElement.focus();
                    }
                }
                
                if (e.key === 'Escape') {
                    closeFilterPanel();
                }
            };
            
            modal.addEventListener('keydown', handleKeyDown);
            
            // Store for cleanup
            modal._focusTrapHandler = handleKeyDown;
        }

        // Date Range Presets
        function setDateRange(preset) {
            const today = new Date();
            let fromDate, toDate;
            
            // Clear active state from all presets
            document.querySelectorAll('.date-preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Set active state on clicked button
            event.target.classList.add('active');
            
            switch(preset) {
                case 'last7days':
                    fromDate = new Date(today.setDate(today.getDate() - 7));
                    toDate = new Date();
                    break;
                case 'last30days':
                    fromDate = new Date(today.setDate(today.getDate() - 30));
                    toDate = new Date();
                    break;
                case 'thisMonth':
                    fromDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    toDate = new Date();
                    break;
                case 'lastMonth':
                    const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    fromDate = lastMonth;
                    toDate = new Date(today.getFullYear(), today.getMonth(), 0);
                    break;
            }
            
            document.getElementById('dateFrom').value = formatDateForInput(fromDate);
            document.getElementById('dateTo').value = formatDateForInput(toDate);
        }

        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Apply Filters
        function applyFilters() {
            // Validate filters
            if (!validateFilters()) {
                return;
            }
            
            // Collect filter values
            activeFilters.dateFrom = document.getElementById('dateFrom').value;
            activeFilters.dateTo = document.getElementById('dateTo').value;
            activeFilters.type = document.querySelector('input[name="txType"]:checked').value;
            
            // Collect checked categories
            activeFilters.categories = Array.from(
                document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked')
            ).filter(cb => cb.id.startsWith('cat-')).map(cb => cb.value);
            
            // Collect checked statuses
            activeFilters.statuses = Array.from(
                document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked')
            ).filter(cb => cb.id.startsWith('status-')).map(cb => cb.value);
            
            activeFilters.currency = document.getElementById('currencyFilter').value;
            
            // Apply filters to transactions
            filterTransactions();
            
            // Update active filter chips
            updateActiveFilterChips();
            
            // Mark filter button as active
            const filterBtn = document.getElementById('filterBtn');
            filterBtn.classList.add('active');
            filterBtn.setAttribute('aria-label', 'Filters active - click to modify');
            
            // Show export button
            const exportContainer = document.getElementById('exportContainer');
            if (exportContainer) exportContainer.style.display = 'flex';
            
            // Close modal
            closeFilterPanel();
            
            // Count filtered transactions
            const visibleCount = document.querySelectorAll('.transaction-item[style*="display: flex"]').length;
            announceToScreenReader(`Filters applied. Showing ${visibleCount} transactions.`);
        }

        function validateFilters() {
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            if (dateFrom && dateTo && new Date(dateFrom) > new Date(dateTo)) {
                alert('Start date must be before end date');
                return false;
            }
            
            return true;
        }

        function filterTransactions() {
            const transactionItems = document.querySelectorAll('.transaction-item');
            let matchCount = 0;
            
            transactionItems.forEach(item => {
                if (matchesFilters(item)) {
                    item.style.display = 'flex';
                    matchCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            hideEmptyDateGroups();
            
            // Show/hide empty state
            if (matchCount === 0) {
                document.getElementById('transactionList').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
            } else {
                document.getElementById('transactionList').style.display = 'block';
                document.getElementById('emptyState').style.display = 'none';
            }
        }

        function matchesFilters(item) {
            // Extract transaction data from DOM
            const title = item.querySelector('.transaction-title')?.textContent || '';
            const meta = item.querySelector('.transaction-meta')?.textContent || '';
            const amountText = item.querySelector('.amount-primary')?.textContent || '';
            const isPositive = item.querySelector('.amount-primary')?.classList.contains('positive');
            const isNegative = item.querySelector('.amount-primary')?.classList.contains('negative');
            
            // Type filter (money in/out)
            if (activeFilters.type !== 'all') {
                if (activeFilters.type === 'in' && !isPositive) return false;
                if (activeFilters.type === 'out' && !isNegative) return false;
            }
            
            // Category filter
            if (activeFilters.categories.length > 0) {
                const hasMatchingCategory = activeFilters.categories.some(cat => {
                    const categoryMap = {
                        'received': ['Received from'],
                        'donation': ['Donation to'],
                        'transfer': ['Sent to', 'Transfer'],
                        'yield': ['Yield Earned', 'Interest'],
                        'bank': ['Bank Transfer']
                    };
                    
                    const keywords = categoryMap[cat] || [];
                    return keywords.some(keyword => title.includes(keyword));
                });
                
                if (!hasMatchingCategory) return false;
            }
            
            // Status filter
            if (activeFilters.statuses.length > 0) {
                const hasMatchingStatus = activeFilters.statuses.some(status => {
                    return meta.toLowerCase().includes(status.toLowerCase());
                });
                
                if (!hasMatchingStatus) return false;
            }
            
            // Currency filter
            if (activeFilters.currency !== 'all') {
                if (!meta.includes(activeFilters.currency)) return false;
            }
            
            // Date filter (simplified - in production, would parse actual dates)
            // For now, we skip date filtering on the demo data
            
            return true;
        }

        function updateActiveFilterChips() {
            const container = document.getElementById('activeFilters');
            container.innerHTML = '';
            
            const chips = [];
            
            // Date range chip
            if (activeFilters.dateFrom || activeFilters.dateTo) {
                const fromStr = activeFilters.dateFrom || 'Start';
                const toStr = activeFilters.dateTo || 'Now';
                chips.push({
                    label: ` ${fromStr} to ${toStr}`,
                    onRemove: () => clearDateFilter()
                });
            }
            
            // Type chip
            if (activeFilters.type !== 'all') {
                const typeLabel = activeFilters.type === 'in' ? ' Money In' : ' Money Out';
                chips.push({
                    label: typeLabel,
                    onRemove: () => clearTypeFilter()
                });
            }
            
            // Category chips
            activeFilters.categories.forEach(cat => {
                const categoryLabels = {
                    'received': ' Received',
                    'donation': ' Donations',
                    'transfer': ' Transfers',
                    'yield': ' Yield',
                    'bank': ' Bank'
                };
                chips.push({
                    label: categoryLabels[cat] || cat,
                    onRemove: () => removeCategoryFilter(cat)
                });
            });
            
            // Currency chip
            if (activeFilters.currency !== 'all') {
                chips.push({
                    label: `Currency: ${activeFilters.currency}`,
                    onRemove: () => clearCurrencyFilter()
                });
            }
            
            if (chips.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'flex';
            
            chips.forEach((chip, index) => {
                const chipEl = document.createElement('div');
                chipEl.className = 'filter-chip';
                chipEl.innerHTML = `
                    <span>${chip.label}</span>
                    <button onclick="window.removeFilterChip(${index})" aria-label="Remove ${chip.label} filter" tabindex="0">
                        <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                `;
                container.appendChild(chipEl);
                
                // Store remove handler
                window[`removeFilterChip${index}`] = chip.onRemove;
            });
            
            // Add "Clear All" button
            const clearAllBtn = document.createElement('button');
            clearAllBtn.className = 'filter-chip-clear-all';
            clearAllBtn.textContent = 'Clear all';
            clearAllBtn.onclick = clearAllFilters;
            clearAllBtn.setAttribute('aria-label', 'Clear all filters');
            container.appendChild(clearAllBtn);
        }

        // Individual filter clearing functions
        window.removeFilterChip = function(index) {
            const handler = window[`removeFilterChip${index}`];
            if (handler) {
                handler();
                applyFilters();
            }
        };

        function clearDateFilter() {
            activeFilters.dateFrom = null;
            activeFilters.dateTo = null;
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.querySelectorAll('.date-preset-btn').forEach(btn => btn.classList.remove('active'));
        }

        function clearTypeFilter() {
            activeFilters.type = 'all';
            document.querySelector('input[name="txType"][value="all"]').checked = true;
        }

        function removeCategoryFilter(category) {
            activeFilters.categories = activeFilters.categories.filter(c => c !== category);
            const checkbox = document.getElementById(`cat-${category}`);
            if (checkbox) checkbox.checked = false;
        }

        function clearCurrencyFilter() {
            activeFilters.currency = 'all';
            document.getElementById('currencyFilter').value = 'all';
        }

        function clearAllFilters() {
            // Reset all filter values
            clearDateFilter();
            clearTypeFilter();
            activeFilters.categories = [];
            activeFilters.statuses = ['completed', 'pending'];
            activeFilters.currency = 'all';
            
            // Reset UI
            document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(cb => {
                if (cb.id === 'status-completed' || cb.id === 'status-pending') {
                    cb.checked = true;
                } else {
                    cb.checked = false;
                }
            });
            document.getElementById('currencyFilter').value = 'all';
            
            // Clear filter chips
            document.getElementById('activeFilters').style.display = 'none';
            document.getElementById('activeFilters').innerHTML = '';
            
            // Remove active state from filter button
            const filterBtn = document.getElementById('filterBtn');
            filterBtn.classList.remove('active');
            filterBtn.setAttribute('aria-label', 'Open filter panel');
            
            // Hide export button
            const exportContainer = document.getElementById('exportContainer');
            if (exportContainer) exportContainer.style.display = 'none';
            
            // Show all transactions
            document.querySelectorAll('.transaction-item').forEach(item => {
                item.style.display = 'flex';
            });
            document.querySelectorAll('.date-group').forEach(group => {
                group.style.display = 'block';
            });
            
            document.getElementById('transactionList').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
            
            announceToScreenReader('All filters cleared');
        }

        // Screen Reader Announcements
        function announceToScreenReader(message) {
            const announcer = document.getElementById('searchAnnouncer');
            if (announcer) {
                announcer.textContent = message;
                setTimeout(() => {
                    announcer.textContent = '';
                }, 1000);
            }
        }

        // ========================================
        // PHASE 6: SAVED FILTER PRESETS
        // ========================================
        
        const PRESETS_STORAGE_KEY = 'filterPresets';
        let savedPresets = [];

        function loadSavedFilters() {
            // Load presets from localStorage
            const stored = localStorage.getItem(PRESETS_STORAGE_KEY);
            savedPresets = stored ? JSON.parse(stored) : [];
            renderFilterPresets();
        }

        function renderFilterPresets() {
            const container = document.getElementById('filterPresets');
            const emptyMessage = document.getElementById('presetsEmpty');
            
            if (!container) return;
            
            if (savedPresets.length === 0) {
                if (emptyMessage) emptyMessage.style.display = 'block';
                container.querySelectorAll('.preset-item').forEach(item => item.remove());
                return;
            }
            
            if (emptyMessage) emptyMessage.style.display = 'none';
            container.querySelectorAll('.preset-item').forEach(item => item.remove());
            
            // Render each preset
            savedPresets.forEach((preset, index) => {
                const presetEl = document.createElement('div');
                presetEl.className = 'preset-item';
                presetEl.innerHTML = `
                    <span class="preset-item-name">${escapeHTML(preset.name)}</span>
                    <div class="preset-item-actions">
                        <button class="preset-delete-btn" onclick="deletePreset(${index})" aria-label="Delete preset ${escapeHTML(preset.name)}" title="Delete" type="button">
                            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </div>
                `;
                
                // Add click handler to preset name
                presetEl.querySelector('.preset-item-name').onclick = () => loadPreset(index);
                presetEl.querySelector('.preset-item-name').style.cursor = 'pointer';
                
                const saveBtn = container.querySelector('.btn-save-preset');
                if (saveBtn) {
                    container.insertBefore(presetEl, saveBtn);
                } else {
                    container.appendChild(presetEl);
                }
            });
        }

        function showSavePresetDialog() {
            const dialog = document.getElementById('presetDialog');
            const input = document.getElementById('presetNameInput');
            
            dialog.classList.add('active');
            dialog.setAttribute('aria-hidden', 'false');
            
            input.value = '';
            setTimeout(() => input.focus(), 100);
            
            document.body.style.overflow = 'hidden';
        }

        function closeSavePresetDialog() {
            const dialog = document.getElementById('presetDialog');
            dialog.classList.remove('active');
            dialog.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        function saveFilterPreset() {
            const nameInput = document.getElementById('presetNameInput');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Please enter a name for this preset');
                nameInput.focus();
                return;
            }
            
            // Create preset object
            const preset = {
                name: name,
                filters: {
                    dateFrom: document.getElementById('dateFrom').value,
                    dateTo: document.getElementById('dateTo').value,
                    type: document.querySelector('input[name="txType"]:checked').value,
                    categories: Array.from(
                        document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked')
                    ).filter(cb => cb.id.startsWith('cat-')).map(cb => cb.value),
                    statuses: Array.from(
                        document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked')
                    ).filter(cb => cb.id.startsWith('status-')).map(cb => cb.value),
                    currency: document.getElementById('currencyFilter').value
                },
                createdAt: new Date().toISOString()
            };
            
            savedPresets.push(preset);
            localStorage.setItem(PRESETS_STORAGE_KEY, JSON.stringify(savedPresets));
            
            renderFilterPresets();
            closeSavePresetDialog();
            
            announceToScreenReader(`Filter preset "${name}" saved`);
        }

        function loadPreset(index) {
            const preset = savedPresets[index];
            if (!preset) return;
            
            // Apply preset filters
            activeFilters = {...preset.filters};
            
            // Update UI
            document.getElementById('dateFrom').value = preset.filters.dateFrom || '';
            document.getElementById('dateTo').value = preset.filters.dateTo || '';
            
            const typeRadio = document.querySelector(`input[name="txType"][value="${preset.filters.type}"]`);
            if (typeRadio) typeRadio.checked = true;
            
            // Update checkboxes
            document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(cb => {
                if (cb.id.startsWith('cat-')) {
                    cb.checked = preset.filters.categories.includes(cb.value);
                }
                if (cb.id.startsWith('status-')) {
                    cb.checked = preset.filters.statuses.includes(cb.value);
                }
            });
            
            document.getElementById('currencyFilter').value = preset.filters.currency;
            
            // Apply and close
            applyFilters();
            
            announceToScreenReader(`Applied preset "${preset.name}"`);
        }

        function deletePreset(index) {
            const preset = savedPresets[index];
            if (!preset) return;
            
            if (confirm(`Delete preset "${preset.name}"?`)) {
                savedPresets.splice(index, 1);
                localStorage.setItem(PRESETS_STORAGE_KEY, JSON.stringify(savedPresets));
                renderFilterPresets();
                announceToScreenReader(`Preset "${preset.name}" deleted`);
            }
        }

        function escapeHTML(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // ========================================
        // PHASE 7: EXPORT FILTERED RESULTS
        // ========================================
        
        function showExportDialog() {
            const dialog = document.getElementById('exportDialog');
            const visibleCount = document.querySelectorAll('.transaction-item[style*="display: flex"]').length;
            
            // Update count in dialog
            document.querySelector('#exportInfo strong').textContent = visibleCount;
            
            dialog.classList.add('active');
            dialog.setAttribute('aria-hidden', 'false');
            
            document.body.style.overflow = 'hidden';
        }

        function closeExportDialog() {
            const dialog = document.getElementById('exportDialog');
            dialog.classList.remove('active');
            dialog.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        function exportTransactions(format) {
            const visibleTransactions = extractVisibleTransactions();
            
            if (visibleTransactions.length === 0) {
                alert('No transactions to export');
                return;
            }
            
            let fileName = `transactions_${new Date().toISOString().split('T')[0]}`;
            let content, mimeType;
            
            switch(format) {
                case 'csv':
                    content = generateCSV(visibleTransactions);
                    fileName += '.csv';
                    mimeType = 'text/csv';
                    break;
                case 'json':
                    content = JSON.stringify(visibleTransactions, null, 2);
                    fileName += '.json';
                    mimeType = 'application/json';
                    break;
                case 'pdf':
                    // PDF generation is more complex - this is a simplified version
                    // In production, use a library like jsPDF
                    alert('PDF export coming soon! For now, please use CSV or JSON format.');
                    return;
            }
            
            // Create and trigger download
            downloadFile(content, fileName, mimeType);
            
            closeExportDialog();
            announceToScreenReader(`Exported ${visibleTransactions.length} transactions as ${format.toUpperCase()}`);
        }

        function extractVisibleTransactions() {
            const transactions = [];
            const visibleItems = document.querySelectorAll('.transaction-item[style*="display: flex"]');
            
            visibleItems.forEach(item => {
                const title = item.querySelector('.transaction-title')?.textContent.trim() || '';
                const meta = item.querySelector('.transaction-meta')?.textContent.trim() || '';
                const amount = item.querySelector('.amount-primary')?.textContent.trim() || '';
                const secondary = item.querySelector('.amount-secondary')?.textContent.trim() || '';
                
                // Parse meta data (time, status, currency)
                const metaParts = meta.split('').map(s => s.trim());
                
                transactions.push({
                    title: title,
                    time: metaParts[0] || '',
                    status: metaParts[1] || '',
                    currency: metaParts[2] || '',
                    amount: amount,
                    secondary: secondary
                });
            });
            
            return transactions;
        }

        function generateCSV(transactions) {
            // CSV header
            let csv = 'Title,Time,Status,Currency,Amount,Additional\n';
            
            // Add rows
            transactions.forEach(tx => {
                const row = [
                    escapeCsvValue(tx.title),
                    escapeCsvValue(tx.time),
                    escapeCsvValue(tx.status),
                    escapeCsvValue(tx.currency),
                    escapeCsvValue(tx.amount),
                    escapeCsvValue(tx.secondary)
                ].join(',');
                
                csv += row + '\n';
            });
            
            return csv;
        }

        function escapeCsvValue(value) {
            // Escape quotes and wrap in quotes if contains comma, quote, or newline
            if (!value) return '""';
            value = value.replace(/"/g, '""');
            if (value.includes(',') || value.includes('"') || value.includes('\n')) {
                return `"${value}"`;
            }
            return value;
        }

        function downloadFile(content, fileName, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // ========================================
        // PHASE 4: LOAD MORE / PAGINATION
        // ========================================
        
        let displayedTransactionCount = 10; // Initially show 10
        const loadIncrement = 10; // Load 10 more each time
        let totalTransactions = 0; // Will be calculated
        let isLoading = false;
        let allTransactionsLoaded = false;

        function initializePagination() {
            // Count total transactions
            const allItems = document.querySelectorAll('.transaction-item');
            totalTransactions = allItems.length;
            
            // Hide transactions beyond initial display count
            allItems.forEach((item, index) => {
                if (index >= displayedTransactionCount) {
                    item.setAttribute('data-initially-hidden', 'true');
                    item.style.display = 'none';
                }
            });
            
            // Update counter
            updateTransactionCount();
            
            // Setup infinite scroll observer
            setupInfiniteScroll();
            
            // Show/hide load more button
            updateLoadMoreButton();
        }

        function loadMoreTransactions() {
            if (isLoading || allTransactionsLoaded) return;
            
            isLoading = true;
            
            // Show loading indicator
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            loadMoreBtn.style.display = 'none';
            loadingIndicator.style.display = 'flex';
            
            // Simulate API delay (remove in production)
            setTimeout(() => {
                const allItems = document.querySelectorAll('.transaction-item');
                let newlyShown = 0;
                
                // Show next batch of hidden transactions
                for (let i = 0; i < allItems.length && newlyShown < loadIncrement; i++) {
                    const item = allItems[i];
                    if (item.style.display === 'none' && item.getAttribute('data-initially-hidden') === 'true') {
                        item.style.display = 'flex';
                        newlyShown++;
                        displayedTransactionCount++;
                    }
                }
                
                // Update UI
                updateTransactionCount();
                updateLoadMoreButton();
                
                // Hide loading indicator
                loadingIndicator.style.display = 'none';
                
                // Check if all loaded
                if (displayedTransactionCount >= totalTransactions) {
                    allTransactionsLoaded = true;
                    loadMoreBtn.style.display = 'none';
                    announceToScreenReader('All transactions loaded');
                } else {
                    loadMoreBtn.style.display = 'inline-flex';
                    announceToScreenReader(`Loaded ${newlyShown} more transactions. Showing ${displayedTransactionCount} of ${totalTransactions}.`);
                }
                
                isLoading = false;
            }, 800); // Simulated delay
        }

        function updateTransactionCount() {
            document.getElementById('shownCount').textContent = displayedTransactionCount;
            document.getElementById('totalCount').textContent = totalTransactions;
        }

        function updateLoadMoreButton() {
            const btn = document.getElementById('loadMoreBtn');
            const remaining = totalTransactions - displayedTransactionCount;
            
            if (remaining > 0) {
                const loadText = remaining <= loadIncrement 
                    ? `Load Last ${remaining} Transactions` 
                    : `Load More (${remaining} remaining)`;
                document.getElementById('loadMoreText').textContent = loadText;
                btn.style.display = 'inline-flex';
            } else {
                btn.style.display = 'none';
                allTransactionsLoaded = true;
            }
        }

        // Infinite Scroll Implementation
        let infiniteScrollObserver = null;

        function setupInfiniteScroll() {
            if ('IntersectionObserver' in window) {
                const sentinel = document.getElementById('scrollSentinel');
                
                infiniteScrollObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && !isLoading && !allTransactionsLoaded) {
                            loadMoreTransactions();
                        }
                    });
                }, {
                    rootMargin: '100px' // Start loading 100px before reaching bottom
                });
                
                infiniteScrollObserver.observe(sentinel);
            }
        }

        function disableInfiniteScroll() {
            if (infiniteScrollObserver) {
                infiniteScrollObserver.disconnect();
            }
        }

        // Scroll to Top function
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Dismiss alert banner
        function dismissAlert() {
            const alert = document.getElementById('kycAlert');
            if (alert) {
                alert.style.transition = 'all 0.3s ease-out';
                alert.style.opacity = '0';
                alert.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    alert.style.display = 'none';
                    localStorage.setItem('kycAlertDismissed', 'true');
                }, 300);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('UNERA Wallet Enhanced - Loaded');
            
            // Initialize pagination/load more
            initializePagination();
            
            // Initialize saved filters (if any)
            loadSavedFilters();
            
            // Check wallet creation - redirect if no wallet exists
            const hasWallet = !!localStorage.getItem('walletAddress');
            if (!hasWallet) {
                // User accessed wallet page without creating a wallet
                const shouldCreate = confirm('You need to create a wallet first. Would you like to create one now?');
                if (shouldCreate) {
                    localStorage.setItem('walletCreationReturn', 'wallet');
                    window.location.href = 'wallet-creation.html?return=wallet';
                } else {
                    window.location.href = 'dashboard-enhanced.html';
                }
                return;
            }
            
            // Banner Priority Logic for Wallet Page
            const kycStatus = localStorage.getItem('kycStatus');
            const kycAlert = document.getElementById('kycAlert');
            
            if (kycStatus === 'verified' && kycAlert) {
                // KYC is done, hide KYC banner
                kycAlert.style.display = 'none';
            } else if (localStorage.getItem('kycAlertDismissed') === 'true' && kycAlert) {
                // Check if alert was previously dismissed
                kycAlert.style.display = 'none';
            }
            
            // Announce page load to screen readers
            const announcement = document.createElement('div');
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.style.position = 'absolute';
            announcement.style.left = '-10000px';
            announcement.textContent = 'Wallet page loaded. Your total balance is $8,250.00';
            document.body.appendChild(announcement);
        });
    </script>
</body>
</html>
